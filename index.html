<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شبابيك للستائر - Shababek Curtains</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/3y1ZNCk0/1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root { --gold: #d9b382; --brown: #3d2e24; --bg: #f9f6f2; --white: #ffffff; --whatsapp: #25D366; --red: #ff4d4d; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--white); color: var(--brown); overflow-x: hidden; scroll-behavior: smooth; line-height: 1.6; }

        .top-banner { background: var(--brown); color: white; padding: 10px 5%; text-align: center; font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
        .wa-link { color: var(--whatsapp); text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 5px; }

        header { background: var(--white); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .logo-center { flex: 1; display: flex; justify-content: center; cursor: pointer; }
        .logo-img { height: 90px; transition: 0.3s; }
        
        .header-left { flex: 1; display: flex; justify-content: flex-end; align-items: center; gap: 15px; }
        .cart-icon { position: relative; cursor: pointer; font-size: 2.2rem; color: var(--brown); background: white; padding: 5px; border-radius: 12px; transition: 0.3s; border: 1px solid #eee; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: var(--red); color: white; font-size: 0.85rem; padding: 2px 8px; border-radius: 50%; font-weight: 900; }
        
        .search-box { position: relative; width: 40px; height: 40px; transition: 0.4s; overflow: hidden; border: 1px solid #eee; border-radius: 12px; display: flex; align-items: center; }
        .search-box:hover, .search-box:focus-within { width: 180px; border-color: var(--gold); }
        .search-box input { border: none; outline: none; background: transparent; padding: 10px; width: 140px; font-size: 0.9rem; }
        .search-box i { padding: 10px; color: var(--brown); cursor: pointer; }

        .nav-bar { background: #fcfcfc; border-bottom: 1px solid #eee; padding: 12px 0; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-menu { display: inline-flex; gap: 25px; list-style: none; padding: 0 20px; }
        .nav-menu a { text-decoration: none; color: var(--brown); font-weight: 700; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .nav-menu a:hover { color: var(--gold); }
        .nav-menu a.active { color: var(--gold); }

        .page { display: none; width: 100%; animation: fadeIn 0.4s ease; }
        .active { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #cartOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .cart-modal { background: var(--white); width: 90%; max-width: 500px; border-radius: 30px; padding: 35px; position: relative; max-height: 90vh; overflow-y: auto; }
        .cart-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; }

        .hero { height: 70vh; background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.3)), url('https://i.ibb.co/0R1MK2d7/Gemini-Generated-Image-tnocdatnocdatnoc.png'); background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; padding: 20px; }
        .hero h1 { font-size: clamp(1.8rem, 5vw, 3.5rem); font-weight: 900; margin-bottom: 25px; text-shadow: 0 2px 15px rgba(0,0,0,0.4); }
        .hero-btns { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 320px; margin-bottom: 30px; }
        .btn-gold { background: var(--gold); color: white; border: none; padding: 16px 35px; border-radius: 12px; font-weight: 900; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        .btn-trans { background: transparent; color: white; border: 2px solid white; padding: 16px 35px; border-radius: 12px; font-weight: 900; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }

        .social-hero { display: flex; gap: 20px; }
        .social-hero a { color: var(--white); font-size: 1.8rem; transition: 0.4s; }
        .social-hero a:hover { color: var(--gold); transform: translateY(-8px) scale(1.2); }

        .features-section { background: var(--bg); padding: 50px 5%; text-align: center; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; max-width: 1200px; margin: auto; }
        .f-card { background: white; padding: 25px 15px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); transition: 0.3s; }
        .f-card:hover { transform: translateY(-5px); border: 1px solid var(--gold); }

        .stat-grid { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .stat-card { background: #f4f1ed; padding: 25px; border-radius: 20px; text-align: center; }
        .stat-num { font-size: 2.2rem; font-weight: 900; color: var(--gold); display: block; }

        .footer-cta { background: var(--brown); color: white; padding: 40px 5%; text-align: center; border-radius: 40px 40px 0 0; }
        .footer-cta h2 { font-size: 1.6rem; font-weight: 900; margin-bottom: 10px; }
        .btn-footer-wa { background: transparent; border: 1px solid rgba(255,255,255,0.4); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; margin: 5px; font-weight: 600; font-size: 0.9rem; }
        .btn-footer-prod { background: var(--gold); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; margin: 5px; font-weight: 600; font-size: 0.9rem; }

        .admin-box { background: #f4f4f4; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: right; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 10px; overflow: hidden; font-size: 0.85rem; table-layout: fixed; }
        .admin-table td { padding: 10px; border-bottom: 1px solid #eee; word-wrap: break-word; }
        .admin-table img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; font-family: 'Cairo'; }

        footer { background: var(--brown); color: rgba(255,255,255,0.6); padding: 20px 5%; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; }
        
        #searchRes { position: absolute; top: 110px; left: 5%; width: 90%; background: white; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 20px; padding: 15px; display: none; max-height: 400px; overflow-y: auto; }
        
        /* تنسيق أقسام المنتجات */
        #categoriesList {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr) !important; 
            gap: 15px;
            padding: 20px 5%;
        }

        .cat-card-new {
            position: relative;
            height: 350px;
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: 0.3s;
        }
        
        .cat-card-new:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .cat-card-new img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: 0.5s;
        }
        
        .cat-card-new:hover img {
            transform: scale(1.1);
        }
        
        .cat-card-new > div:last-child {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: white;
            padding: 10px 25px;
            border-radius: 12px;
            font-weight: 900;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            #categoriesList {
                display: flex !important;
                grid-template-columns: none !important;
                overflow-x: auto !important;
                scroll-snap-type: x mandatory;
                gap: 15px;
                padding: 20px;
                -webkit-overflow-scrolling: touch;
            }
            
            #categoriesList .cat-card-new {
                flex: 0 0 250px !important;
                height: 300px;
                scroll-snap-align: start;
            }
        }

        /* تنسيق شبكة المنتجات */
        #catGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            padding: 20px 5%;
        }
        
        /* تنسيق طرق الدفع مثل المنتدى */
        #paymentList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .payment-card {
            position: relative;
            height: 400px;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            border: 1px solid #f0f0f0;
            background: white;
            transition: 0.4s;
        }
        
        .payment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
        }
        
        .payment-card img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 30px;
            display: block;
        }
        
        .payment-card .payment-overlay {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: var(--gold);
            color: white;
            padding: 8px 5px;
            text-align: center;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10;
            font-weight: 900;
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            #paymentList {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            .payment-card {
                height: 320px;
            }
        }

        /* مؤشر التحميل */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== مستعرض المنتجات المتطور (القديم) ===== */
        .product-viewer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .product-viewer-container.active {
            display: flex;
            opacity: 1;
        }
        
        .viewer-content {
            position: relative;
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            background: #111;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--gold);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .viewer-close:hover {
            transform: scale(1.1);
            background: var(--brown);
        }
        
        .viewer-main {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .viewer-slides {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.3s ease;
        }
        
        .viewer-slide {
            flex: 0 0 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .viewer-slide img,
        .viewer-slide video {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            cursor: crosshair;
            transition: transform 0.1s ease;
            user-select: none;
        }
        
        .viewer-slide img.zoomed,
        .viewer-slide video.zoomed {
            transform: scale(2);
            cursor: zoom-out;
        }
        
        /* عدسة التكبير */
        .zoom-lens {
            position: absolute;
            border: 3px solid var(--gold);
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            pointer-events: none;
            z-index: 10;
            display: none;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        
        .viewer-slide:hover .zoom-lens {
            display: block;
        }
        
        /* أزرار التنقل */
        .viewer-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: var(--gold);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .viewer-nav:hover {
            background: var(--brown);
            transform: translateY(-50%) scale(1.1);
        }
        
        .viewer-nav.prev {
            left: 20px;
        }
        
        .viewer-nav.next {
            right: 20px;
        }
        
        /* مؤشر التقدم */
        .viewer-progress {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10001;
            background: rgba(0,0,0,0.5);
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }
        
        .progress-dot {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.3s;
            opacity: 0.7;
        }
        
        .progress-dot.active {
            border-color: var(--gold);
            transform: scale(1.1);
            opacity: 1;
        }
        
        .progress-dot img,
        .progress-dot video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .progress-dot.video-thumb {
            position: relative;
        }
        
        .progress-dot.video-thumb::after {
            content: '▶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.5);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        /* معلومات المنتج */
        .viewer-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            z-index: 10001;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid var(--gold);
        }
        
        .viewer-info h3 {
            font-size: 1.3rem;
            font-weight: 900;
        }
        
        .viewer-info .price {
            color: var(--gold);
            font-weight: 900;
            font-size: 1.3rem;
        }
        
        .viewer-info .add-to-cart {
            background: var(--gold);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 900;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .viewer-info .add-to-cart:hover {
            background: white;
            color: var(--brown);
        }
        
        /* التمرير التلقائي */
        .auto-play-toggle {
            position: absolute;
            bottom: 100px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--gold);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }
        
        .auto-play-toggle.paused {
            background: #666;
        }
        
        /* للهواتف */
        @media (max-width: 768px) {
            .viewer-nav {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .viewer-progress {
                bottom: 20px;
                padding: 10px 15px;
                gap: 8px;
            }
            
            .progress-dot {
                width: 35px;
                height: 35px;
            }
            
            .viewer-info {
                flex-direction: column;
                align-items: flex-start;
                top: 10px;
                left: 10px;
                padding: 10px 15px;
                gap: 10px;
            }
            
            .viewer-info h3 {
                font-size: 1rem;
            }
            
            .viewer-info .price {
                font-size: 1rem;
            }
            
            .viewer-info .add-to-cart {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .auto-play-toggle {
                bottom: 80px;
                right: 15px;
                width: 40px;
                height: 40px;
            }
        }
        
        /* ===== مستعرض المنتجات بنظام Alibaba ===== */
        .alibaba-viewer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .alibaba-viewer-container.active {
            display: flex;
            opacity: 1;
        }
        
        .alibaba-viewer-content {
            width: 95%;
            max-width: 1400px;
            height: 95vh;
            background: white;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }
        
        /* رأس المستعرض */
        .alibaba-viewer-header {
            background: var(--brown);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--gold);
        }
        
        .alibaba-viewer-header h2 {
            font-size: 1.4rem;
            font-weight: 900;
            margin: 0;
        }
        
        .alibaba-viewer-header .product-code {
            color: var(--gold);
            font-size: 0.9rem;
        }
        
        .alibaba-viewer-close {
            background: var(--gold);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .alibaba-viewer-close:hover {
            transform: rotate(90deg);
            background: var(--brown);
        }
        
        /* الجسم الرئيسي */
        .alibaba-viewer-body {
            display: flex;
            flex: 1;
            overflow: hidden;
            background: #f8f8f8;
        }
        
        /* الجانب الأيمن - عرض الوسائط */
        .alibaba-viewer-media {
            flex: 1.5;
            padding: 20px;
            background: white;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        /* الصورة الرئيسية */
        .alibaba-main-image-container {
            background: #f5f5f5;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid #eee;
            position: relative;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .alibaba-main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: crosshair;
            transition: transform 0.2s;
        }
        
        .alibaba-main-image.zoomed {
            transform: scale(2);
            cursor: zoom-out;
        }
        
        /* معرض الصور المصغرة */
        .alibaba-thumbnail-gallery {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
        }
        
        .alibaba-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.3s;
            flex-shrink: 0;
            background: #f0f0f0;
        }
        
        .alibaba-thumbnail:hover {
            transform: translateY(-3px);
        }
        
        .alibaba-thumbnail.active {
            border-color: var(--gold);
            box-shadow: 0 5px 15px rgba(217, 179, 130, 0.3);
        }
        
        .alibaba-thumbnail img,
        .alibaba-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .alibaba-thumbnail.video-thumb {
            position: relative;
        }
        
        .alibaba-thumbnail.video-thumb::after {
            content: '▶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.5);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        /* عدسة التكبير */
        .alibaba-zoom-lens {
            position: absolute;
            width: 150px;
            height: 150px;
            border: 3px solid var(--gold);
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            pointer-events: none;
            display: none;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        
        .alibaba-main-image-container:hover .alibaba-zoom-lens {
            display: block;
        }
        
        /* الجانب الأيسر - معلومات المنتج */
        .alibaba-viewer-info {
            flex: 1;
            padding: 30px;
            background: white;
            border-left: 1px solid #eee;
            overflow-y: auto;
        }
        
        .alibaba-product-title {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 15px;
            color: var(--brown);
            line-height: 1.3;
        }
        
        .alibaba-product-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .alibaba-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .alibaba-meta-item i {
            color: var(--gold);
        }
        
        /* سعر المنتج */
        .alibaba-price-section {
            background: #faf5f0;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #f0e0d0;
        }
        
        .alibaba-price-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .alibaba-price {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--gold);
            display: flex;
            align-items: baseline;
            gap: 5px;
        }
        
        .alibaba-price-unit {
            font-size: 1rem;
            color: #999;
            font-weight: normal;
        }
        
        .alibaba-price-note {
            font-size: 0.8rem;
            color: #999;
            margin-top: 5px;
        }
        
        /* قسم عدد الأمتار */
        .alibaba-meters-section {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
        }
        
        .alibaba-meters-label {
            font-weight: 900;
            margin-bottom: 15px;
            color: var(--brown);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alibaba-meters-label i {
            color: var(--gold);
            font-size: 1.2rem;
        }
        
        .alibaba-meters-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .alibaba-meters-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: 'Cairo', sans-serif;
            transition: 0.3s;
        }
        
        .alibaba-meters-input:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(217, 179, 130, 0.2);
        }
        
        .alibaba-meters-unit {
            font-size: 1.1rem;
            color: #666;
            font-weight: 900;
        }
        
        .alibaba-total-price {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alibaba-total-label {
            font-weight: 900;
            color: var(--brown);
        }
        
        .alibaba-total-value {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--gold);
        }
        
        /* أزرار الإجراءات */
        .alibaba-action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }
        
        .alibaba-add-to-cart-btn {
            background: var(--gold);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .alibaba-add-to-cart-btn:hover {
            background: var(--brown);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .alibaba-buy-now-btn {
            background: white;
            color: var(--brown);
            border: 2px solid var(--gold);
            padding: 18px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .alibaba-buy-now-btn:hover {
            background: var(--gold);
            color: white;
        }
        
        /* خصائص المنتج */
        .alibaba-specs-section {
            margin-top: 30px;
        }
        
        .alibaba-specs-title {
            font-weight: 900;
            margin-bottom: 15px;
            color: var(--brown);
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold);
        }
        
        .alibaba-specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .alibaba-spec-item {
            display: flex;
            flex-direction: column;
        }
        
        .alibaba-spec-label {
            font-size: 0.8rem;
            color: #999;
        }
        
        .alibaba-spec-value {
            font-weight: 700;
            color: var(--brown);
        }
        
        /* للهواتف */
        @media (max-width: 768px) {
            .alibaba-viewer-body {
                flex-direction: column;
            }
            
            .alibaba-main-image-container {
                height: 250px;
            }
            
            .alibaba-product-title {
                font-size: 1.4rem;
            }
            
            .alibaba-specs-grid {
                grid-template-columns: 1fr;
            }
            
            .alibaba-viewer-header h2 {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="top-banner">
        <span>شبابيك للستائر - ظل وذوق</span>
        <a href="https://wa.me/9647883002797" class="wa-link"><i class="fab fa-whatsapp"></i> تواصل عبر الواتساب</a>
    </div>

    <header>
        <div style="font-weight:900; line-height:1; flex:1;">شبابيك<br><span style="color:var(--gold); font-size:1rem;">للستائر</span></div>
        <div class="logo-center" onclick="handleLogoClick()"><img src="https://i.ibb.co/3y1ZNCk0/1.png" class="logo-img"></div>
        <div class="header-left">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="ابحث عن موديل.." onkeyup="handleSearch()">
            </div>
            <div class="cart-icon" onclick="toggleCartModal()">
                <i class="fas fa-shopping-basket"></i>
                <span id="globalCartCount" class="cart-count">0</span>
            </div>
        </div>
    </header>
    
    <div id="searchRes"></div>

    <div class="nav-bar">
        <ul class="nav-menu">
            <li><a onclick="showPage('homePage')">الرئيسية</a></li>
            <li><a onclick="showPage('homePage'); setTimeout(() => { document.getElementById('categories').scrollIntoView({behavior: 'smooth'}); }, 100);">المنتجات</a></li>
            <li><a href="ai.html">منتدى شبابيك</a></li>
            <li><a onclick="showPage('paymentPage')">طرق الدفع</a></li>
            <li><a onclick="showPage('aboutPage')">من نحن</a></li>
            <li><a onclick="showPage('contactPage')">تواصل معنا</a></li>
        </ul>
    </div>

    <div id="cartOverlay" onclick="if(event.target===this) toggleCartModal()">
        <div class="cart-modal">
            <h2 style="margin-bottom:20px; border-bottom:2px solid var(--gold); padding-bottom:10px; font-weight:900;">سلة المشتريات</h2>
            <div id="cartItemsList"></div>
            
            <div id="checkoutFields" style="margin-top:20px; border-top:2px solid var(--gold); padding-top:15px;">
                <label style="font-weight:bold; font-size:0.9rem;">المحافظة:</label>
                <select id="userCity">
                    <option value="بغداد">بغداد</option><option value="البصرة">البصرة</option><option value="نينوى">نينوى</option><option value="أربيل">أربيل</option><option value="النجف">النجف</option><option value="كربلاء">كربلاء</option><option value="بابل">بابل</option><option value="الأنبار">الأنبار</option><option value="ذي قار">ذي قار</option><option value="ديالى">ديالى</option><option value="ميسان">ميسان</option><option value="واسط">واسط</option><option value="المثنى">المثنى</option><option value="كركوك">كركوك</option><option value="صلاح الدين">صلاح الدين</option><option value="دهوك">دهوك</option><option value="السليمانية">السليمانية</option><option value="القادسية">القادسية</option>
                </select>

                <label style="font-weight:bold; font-size:0.9rem; margin-top:10px; display:block;">هل تحتاج خدمة تركيب؟</label>
                <select id="userInstall">
                    <option value="بدون تركيب">لا، بدون تركيب</option>
                    <option value="مع التركيب">نعم، أحتاج تركيب</option>
                </select>

                <label style="font-weight:bold; font-size:0.9rem; margin-top:10px; display:block;">طريقة الدفع:</label>
                <select id="userPayment"></select>
            </div>

            <div style="margin-top:20px;">
                <button class="btn-gold" style="width:100%; padding:20px;" onclick="sendOrder()">إرسال الطلب عبر واتساب</button>
                <p onclick="toggleCartModal()" style="margin-top:20px; text-align:center; color:#999; cursor:pointer; font-weight:bold;">إغلاق</p>
            </div>
        </div>
    </div>

    <!-- مستعرض المنتجات المتطور (القديم) - مخفي لكن محتفظ به للتوافق -->
    <div class="product-viewer-container" id="productViewer" onclick="if(event.target===this) closeViewer()" style="display:none;">
        <div class="viewer-content">
            <button class="viewer-close" onclick="closeViewer()"><i class="fas fa-times"></i></button>
            
            <div class="viewer-info" id="viewerInfo">
                <h3 id="viewerProductName"></h3>
                <span class="price" id="viewerProductPrice"></span>
                <button class="add-to-cart" onclick="addCurrentToCart()"><i class="fas fa-cart-plus"></i> أضف للسلة</button>
            </div>
            
            <div class="viewer-main" id="viewerMain">
                <div class="viewer-slides" id="viewerSlides" style="transform: translateX(0px);"></div>
                
                <div class="zoom-lens" id="zoomLens"></div>
                
                <button class="viewer-nav prev" onclick="navigateSlide(-1)"><i class="fas fa-chevron-right"></i></button>
                <button class="viewer-nav next" onclick="navigateSlide(1)"><i class="fas fa-chevron-left"></i></button>
                
                <button class="auto-play-toggle" id="autoPlayToggle" onclick="toggleAutoPlay()">
                    <i class="fas fa-play"></i>
                </button>
            </div>
            
            <div class="viewer-progress" id="viewerProgress"></div>
        </div>
    </div>

    <!-- مستعرض المنتجات بنظام Alibaba (الجديد) -->
    <div class="alibaba-viewer-container" id="alibabaViewer" onclick="if(event.target===this) closeAlibabaViewer()">
        <div class="alibaba-viewer-content">
            <!-- رأس المستعرض -->
            <div class="alibaba-viewer-header">
                <div>
                    <h2 id="alibabaProductName">اسم المنتج</h2>
                    <span class="product-code" id="alibabaProductCode">موديل: ST-2024</span>
                </div>
                <button class="alibaba-viewer-close" onclick="closeAlibabaViewer()"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- جسم المستعرض -->
            <div class="alibaba-viewer-body">
                <!-- الجانب الأيمن: عرض الوسائط -->
                <div class="alibaba-viewer-media">
                    <!-- الصورة الرئيسية -->
                    <div class="alibaba-main-image-container" id="alibabaMainImageContainer">
                        <img id="alibabaMainImage" class="alibaba-main-image" src="" alt="">
                        <div class="alibaba-zoom-lens" id="alibabaZoomLens"></div>
                    </div>
                    
                    <!-- المعرض المصغر -->
                    <div class="alibaba-thumbnail-gallery" id="alibabaThumbnailGallery"></div>
                </div>
                
                <!-- الجانب الأيسر: معلومات المنتج -->
                <div class="alibaba-viewer-info">
                    <h1 class="alibaba-product-title" id="alibabaProductTitle">اسم المنتج</h1>
                    
                    <div class="alibaba-product-meta">
                        <div class="alibaba-meta-item">
                            <i class="fas fa-star"></i>
                            <span id="alibabaProductRating">4.8 (128 تقييم)</span>
                        </div>
                        <div class="alibaba-meta-item">
                            <i class="fas fa-shopping-bag"></i>
                            <span id="alibabaProductSold">أكثر من 500 قطعة مباعة</span>
                        </div>
                    </div>
                    
                    <!-- قسم السعر -->
                    <div class="alibaba-price-section">
                        <div class="alibaba-price-label">سعر المتر</div>
                        <div class="alibaba-price">
                            <span id="alibabaProductPrice">0</span>
                            <span class="alibaba-price-unit">د.ع</span>
                        </div>
                        <div class="alibaba-price-note">السعر شامل الضريبة</div>
                    </div>
                    
                    <!-- قسم عدد الأمتار -->
                    <div class="alibaba-meters-section">
                        <div class="alibaba-meters-label">
                            <i class="fas fa-ruler"></i>
                            أدخل عدد الأمتار المطلوبة
                        </div>
                        <div class="alibaba-meters-input-group">
                            <input type="number" id="alibabaMetersInput" class="alibaba-meters-input" 
                                   placeholder="مثلاً: 5" min="0.5" step="0.5" value="1">
                            <span class="alibaba-meters-unit">متر</span>
                        </div>
                        <div class="alibaba-total-price">
                            <span class="alibaba-total-label">الإجمالي:</span>
                            <span class="alibaba-total-value" id="alibabaTotalPrice">0 د.ع</span>
                        </div>
                    </div>
                    
                    <!-- أزرار الإجراءات -->
                    <div class="alibaba-action-buttons">
                        <button class="alibaba-add-to-cart-btn" onclick="addFromAlibabaViewer()">
                            <i class="fas fa-cart-plus"></i>
                            إضافة إلى السلة
                        </button>
                        <button class="alibaba-buy-now-btn" onclick="buyNowFromAlibabaViewer()">
                            <i class="fas fa-bolt"></i>
                            شراء الآن
                        </button>
                    </div>
                    
                    <!-- خصائص المنتج -->
                    <div class="alibaba-specs-section">
                        <div class="alibaba-specs-title">
                            <i class="fas fa-clipboard-list"></i>
                            المواصفات
                        </div>
                        <div class="alibaba-specs-grid" id="alibabaProductSpecs"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="mainContainer">
        <div id="homePage" class="page active">
            <section class="hero">
                <h1>فخامة التفاصيل تبدأ من شبابيك منزلك</h1>
                <div class="hero-btns">
                    <button onclick="document.getElementById('categories').scrollIntoView({behavior: 'smooth'})" class="btn-gold">احسب سعر ستائرك الآن</button>
                    <a href="https://wa.me/9647883002797" class="btn-trans"><i class="fab fa-whatsapp"></i> استشارة مجانية</a>
                </div>
                <div class="social-hero">
                    <a href="https://www.facebook.com/profile.php?id=61587692021311" target="_blank"><i class="fab fa-facebook"></i></a>
                    <a href="https://www.instagram.com/shababek.curtains/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.tiktok.com/@shababek.curtains" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a href="https://youtube.com/@shababek.curtains?si=KKsEbL98N0fq2e2U" target="_blank"><i class="fab fa-youtube"></i></a>
                    <a href="https://x.com/ShababekCurtain" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                    <a href="https://www.snapchat.com/add/shababekcurtin?share_id=B2Prmbx5_Xo&locale=en-IQ" target="_blank"><i class="fab fa-snapchat"></i></a>
                </div>
            </section>
            <section id="categories" style="padding: 40px 0;">
                <h2 style="text-align:center; font-weight:900; margin-bottom:15px;">أقسامنا المميزة</h2>
                <div id="categoriesList"></div>
            </section>
            <section class="features-section">
                <h2 style="margin-bottom:35px; font-weight:900;">لماذا شبابيك؟</h2>
                <div class="features-grid">
                    <div class="f-card"><i class="fa-solid fa-shield-halved" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>ضمان حقيقي</h3><p>أرقى الأقمشة بضمان رسمي.</p></div>
                    <div class="f-card"><i class="fa-solid fa-truck-fast" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>قياس منزلي</h3><p>نصلكم للقياس مجاناً.</p></div>
                    <div class="f-card"><i class="fa-solid fa-ruler-combined" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>تفصيل دقيق</h3><p>خياطة احترافية حسب الطلب.</p></div>
                    <div class="f-card"><i class="fa-solid fa-palette" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>ذوق رفيع</h3><p>أحدث الموديلات العصرية.</p></div>
                </div>
            </section>
        </div>

        <div id="adminPanel" class="page">
            <div style="padding: 40px 5%; max-width: 900px; margin: auto;">
                <h2 style="text-align:center; margin-bottom:40px; font-weight:900;">لوحة الإدارة السحابية</h2>
                <div class="admin-box">
                    <h3>١. إدارة الأقسام</h3>
                    <input type="text" id="admCatName" placeholder="اسم القسم">
                    <input type="file" id="admCatFile" accept="image/*" style="margin: 10px 0; width: 100%;">
                    <button onclick="publishCat()" class="btn-gold">حفظ القسم</button>
                    <table class="admin-table"><tbody id="admListCats"></tbody></table>
                </div>
                <div class="admin-box">
                    <h3>٢. إدارة المنتجات</h3>
                    <select id="admProdCatSelect"></select>
                    <input type="text" id="admProdName" placeholder="اسم الموديل">
                    <input type="number" id="admProdPrice" placeholder="السعر">
                    <input type="file" id="admProdFile" accept="image/*" style="margin: 10px 0; width: 100%;">
                    <input type="text" id="admProdVideo" placeholder="رابط فيديو (اختياري)">
                    <button onclick="publishProd()" class="btn-gold">نشر المنتج</button>
                    <table class="admin-table"><tbody id="admListProds"></tbody></table>
                </div>
                <div class="admin-box">
                    <h3>٣. إدارة طرق الدفع</h3>
                    <input type="text" id="admPayName" placeholder="اسم الطريقة">
                    <input type="file" id="admPayFile" accept="image/*" style="margin: 10px 0; width: 100%;">
                    <button onclick="publishPayment()" class="btn-gold">حفظ طريقة الدفع</button>
                    <table class="admin-table"><tbody id="admListPays"></tbody></table>
                </div>
            </div>
        </div>

        <div id="aboutPage" class="page">
            <div style="padding: 60px 5%; max-width: 1100px; margin: auto;">
                <h2 style="font-weight:900; font-size:2.5rem; margin-bottom:30px; text-align:center;">شبابيك للستائر</h2>
                <p style="font-size:1.2rem; line-height:2.2; color:#444; text-align:justify;">تأسست شبابيك للستائر بهدف تقديم أفخم وأجود أنواع الستائر المنزلية في العراق. نؤمن بأن الستائر ليست مجرد قطعة قماش، بل هي عنصر أساسي في تصميم المنزل يعكس ذوق أصحابه ويضيف لمسة من الأناقة والفخامة. نقدم مجموعة واسعة من الستائر تشمل البلاك أوت والشفافة والديكورية وستائر الرول، بأقمشة مستوردة من أفضل المصانع العالمية. كما نوفر خدمة التفصيل حسب المقاسات وخدمة التركيب المنزلي بأيدي فنيين متخصصين. رؤيتنا هي أن نكون الوجهة الأولى للستائر الفاخرة في العراق، ونسعى دائماً لتحقيق رضا عملائنا من خلال الجودة العالية والأسعار المنافسة والخدمة المتميزة.</p>
                <div class="stat-grid">
                    <div class="stat-card"><span class="stat-num">500+</span><p>عميل سعيد</p></div>
                    <div class="stat-card"><span class="stat-num">50+</span><p>تصميم حصري</p></div>
                    <div class="stat-card"><span class="stat-num">10+</span><p>سنوات خبرة</p></div>
                </div>
            </div>
        </div>
        
        <div id="contactPage" class="page">
            <div style="padding: 60px 5%; text-align: center; background: var(--bg); border-radius: 40px; margin: 40px 5%;">
                <h2 style="margin-bottom:30px; font-weight: 900; font-size: 2.2rem;">تواصل معنا</h2>
                <div><i class="fa-solid fa-phone"></i> 07883002797</div>
                <div style="margin-top:10px;"><i class="fa-solid fa-location-dot"></i> العراق - بغداد</div>
                <a href="https://wa.me/9647883002797" class="btn-gold" style="display:inline-block; text-decoration:none; margin-top:20px;">مراسلة واتساب مباشر</a>
            </div>
        </div>
        
        <div id="categoryView" class="page">
            <h2 id="catTitle" style="text-align:center; padding:40px 0; font-weight:900;"></h2>
            <div id="catGrid"></div>
        </div>
        
        <div id="productCalculator" class="page">
            <div style="padding:40px 5%; max-width:650px; margin:auto; text-align:center;">
                <img id="pImg" src="" style="width:100%; border-radius:25px; margin-bottom:25px;">
                <h2 id="pName"></h2>
                <div style="color:var(--gold); font-size:1.8rem; font-weight:900; margin-bottom:30px;"><span id="pPrice"></span> د.ع / متر</div>
                <input type="number" id="hIn" placeholder="أدخل الطول بالمتر" min="0.5" step="0.5" style="text-align:center;">
                <button onclick="addToCart()" class="btn-gold" style="width:100%;">إضافة للسلة</button>
                <button onclick="toggleCartModal()" style="background:transparent; border:2px solid var(--gold); color:var(--gold); width:100%; padding:18px; border-radius:12px; margin-top:10px;">إتمام الطلب الآن</button>
            </div>
        </div>
        
        <div id="paymentPage" class="page">
            <div style="padding: 40px 5%; text-align: center;">
                <h2 style="font-weight:900; margin-bottom:30px;">طرق الدفع الآمنة</h2>
                <div id="paymentList"></div>
            </div>
        </div>
    </main>

    <div class="footer-cta">
        <h2>جاهز لتجديد ستائر منزلك؟</h2>
        <div style="display:flex; justify-content:center; flex-wrap:wrap; gap:10px;">
            <a href="https://wa.me/9647883002797" class="btn-footer-wa">تواصل عبر واتساب</a>
            <a onclick="showPage('homePage'); document.getElementById('categories').scrollIntoView({behavior: 'smooth'})" class="btn-footer-prod">تصفح المنتجات</a>
        </div>
    </div>

    <footer>
        <div style="font-size:1.8rem; font-weight:900; color:var(--gold); margin-bottom:10px;">شبابيك</div>
        <p>© 2026 جميع الحقوق محفوظة لشبابيك للستائر - ظل وذوق</p>
    </footer>

    <script>
        // تهيئة Firebase
        const firebaseConfig = { 
            apiKey: "AIzaSyD1TENeV6RkWmrYIjV6seGx84VavsM_tvE", 
            authDomain: "shababekcurtain.firebaseapp.com", 
            databaseURL: "https://shababekcurtain-default-rtdb.asia-southeast1.firebasedatabase.app/", 
            projectId: "shababekcurtain" 
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // متغيرات عامة
        const CLOUD_NAME = "dnkuwf8q9";
        const UPLOAD_PRESET = "afsx4w9k";
        const LOGO_ID = "shababek_logo";
        let currentProduct = null;
        let cart = JSON.parse(localStorage.getItem('shababek_cart')) || [];
        let adminClicks = 0;
        let clickTimer;

        // دالة جلب القيم
        function getValue(id) { 
            const el = document.getElementById(id);
            return el ? el.value : ""; 
        }

        // نظام التنقل بين الصفحات
        function showPage(pageId, pushToHistory = true) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                window.scrollTo(0, 0);
                
                if (pushToHistory) {
                    history.pushState({ page: pageId }, '', `#${pageId}`);
                }
            }
        }

        // معالجة النقر على الشعار (الدخول للوحة التحكم)
        function handleLogoClick() {
            adminClicks++;
            clearTimeout(clickTimer);
            
            if (adminClicks >= 5) {
                adminClicks = 0;
                const pass = prompt("أدخل رمز الدخول السحابي لشبابيك:");
                if (pass === "8496") {
                    showPage('adminPanel');
                    if (typeof confetti === 'function') {
                        confetti({ particleCount: 100, spread: 70 });
                    }
                } else if (pass !== null) { 
                    alert("الرمز غير صحيح!"); 
                }
                return;
            }
            
            clickTimer = setTimeout(() => {
                if (adminClicks === 1) showPage('homePage');
                adminClicks = 0;
            }, 400);
        }

        // رفع الصور إلى Cloudinary
        async function uploadImage(file) {
            if (!file) return "";
            
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", UPLOAD_PRESET);
            
            try {
                const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { 
                    method: "POST", 
                    body: formData 
                });
                const data = await res.json();
                return data.secure_url;
            } catch (error) {
                console.error("خطأ في رفع الصورة:", error);
                alert("فشل في رفع الصورة");
                return "";
            }
        }

        // إضافة علامة مائية
        function getWatermarkedUrl(url) {
            if (!url || !url.includes("cloudinary.com")) return url;
            return url.replace("/upload/", `/upload/l_${LOGO_ID},o_25,w_250,g_center/`);
        }

        // نشر قسم جديد
        async function publishCat() {
            const file = document.getElementById('admCatFile').files[0];
            const name = getValue('admCatName');
            
            if(!file || !name) {
                alert("أكمل بيانات القسم");
                return;
            }
            
            const url = await uploadImage(file);
            if (url) {
                db.ref('categories').push({name: name, img: url}).then(() => {
                    alert("تم إضافة القسم بنجاح");
                    document.getElementById('admCatName').value = "";
                    document.getElementById('admCatFile').value = "";
                });
            }
        }

        // نشر منتج جديد
        async function publishProd() {
            const file = document.getElementById('admProdFile').files[0];
            const cat = document.getElementById('admProdCatSelect').value;
            const name = getValue('admProdName');
            const price = getValue('admProdPrice');
            const video = getValue('admProdVideo');
            
            if(!file || !name || !price || cat === "اختر قسم المنتجات") {
                alert("أكمل بيانات المنتج");
                return;
            }
            
            const url = await uploadImage(file);
            if (url) {
                db.ref('products').push({ 
                    category: cat, 
                    name: name, 
                    price: parseInt(price), 
                    img: url,
                    video: video || ""
                }).then(() => {
                    alert("تم نشر المنتج بنجاح");
                    document.getElementById('admProdName').value = "";
                    document.getElementById('admProdPrice').value = "";
                    document.getElementById('admProdFile').value = "";
                    document.getElementById('admProdVideo').value = "";
                });
            }
        }

        // نشر طريقة دفع جديدة
        async function publishPayment() {
            const file = document.getElementById('admPayFile').files[0];
            const name = getValue('admPayName');
            
            if(!file || !name) {
                alert("أكمل بيانات طريقة الدفع");
                return;
            }
            
            const url = await uploadImage(file);
            if (url) {
                db.ref('payments').push({ 
                    name: name, 
                    img: url 
                }).then(() => {
                    alert("تم إضافة طريقة الدفع بنجاح");
                    document.getElementById('admPayName').value = "";
                    document.getElementById('admPayFile').value = "";
                });
            }
        }

        // حذف عنصر
        function deleteItem(ref, key) { 
            if(confirm("هل تريد الحذف نهائياً؟")) {
                db.ref(ref).child(key).remove(); 
            }
        }

        // فتح قسم المنتجات
        function openCat(categoryName) { 
            localStorage.setItem('lastCat', categoryName);
            db.ref('products').once('value', snap => { 
                const products = snap.val() || {};
                const items = Object.values(products).filter(i => i.category === categoryName); 
                document.getElementById('catTitle').innerText = categoryName; 
                
                if (items.length === 0) {
                    document.getElementById('catGrid').innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;">لا توجد منتجات في هذا القسم</div>';
                } else {
                    document.getElementById('catGrid').innerHTML = items.map(x => `
                        <div class="cat-card-new" onclick='openCalc(${JSON.stringify(x).replace(/'/g, "&apos;")})'>
                            <img src="${x.img}" style="width:100%;height:250px;object-fit:cover;">
                            <div style="padding:20px;text-align:center;"><h3>${x.name}</h3><p style="color:var(--gold);font-weight:900;">${parseInt(x.price).toLocaleString()} د.ع</p></div>
                        </div>`).join('');
                }
                showPage('categoryView'); 
            }); 
        }

        // فتح حاسبة المنتج - معدلة لفتح المستعرض الجديد
        function openCalc(product) { 
            currentProduct = product; 
            localStorage.setItem('lastProd', JSON.stringify(product));
            
            // فتح المستعرض الجديد
            openAlibabaViewer(product);
            
            // تحديث معلومات الحاسبة (للتوافق مع الكود القديم)
            document.getElementById('pName').innerText = product.name; 
            document.getElementById('pPrice').innerText = parseInt(product.price).toLocaleString(); 
            document.getElementById('pImg').src = getWatermarkedUrl(product.img); 
            document.getElementById('hIn').value = '';
        }

        // البحث
        async function handleSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const resBox = document.getElementById('searchRes');
            
            if (query.length < 2) { 
                resBox.style.display = 'none'; 
                return; 
            }

            const [prodsSnap] = await Promise.all([
                db.ref('products').once('value')
            ]);

            const prods = prodsSnap.val() || {};
            let html = "";

            Object.values(prods).filter(p => p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query)).forEach(p => {
                html += `
                    <div style="display:flex;align-items:center;gap:10px;padding:12px;border-bottom:1px solid #eee;cursor:pointer;" 
                         onclick='openCalc(${JSON.stringify(p).replace(/'/g, "&apos;")}); document.getElementById("searchRes").style.display="none";'>
                        <img src="${p.img}" style="width:40px;height:40px;border-radius:5px;object-fit:cover;">
                        <div>
                            <div style="font-weight:bold;font-size:0.9rem;">${p.name}</div>
                            <div style="font-size:0.7rem;color:var(--gold);">${p.category}</div>
                        </div>
                    </div>`;
            });

            if (html !== "") {
                resBox.innerHTML = html;
                resBox.style.display = 'block';
            } else {
                resBox.innerHTML = `<div style="padding:15px;text-align:center;color:#999;">لا توجد نتائج مطابقة</div>`;
                resBox.style.display = 'block';
            }
        }

        // إضافة إلى السلة
        function addToCart() {
            const h = parseFloat(document.getElementById('hIn').value);
            if(!h || h <= 0) return alert("أدخل الطول بالمتر");
            if(!currentProduct) return alert("حدث خطأ");
            
            cart.push({ 
                n: currentProduct.name, 
                p: Math.round(h * currentProduct.price), 
                img: getWatermarkedUrl(currentProduct.img),
                length: h
            });
            
            document.getElementById('globalCartCount').innerText = cart.length; 
            localStorage.setItem('shababek_cart', JSON.stringify(cart));
            alert("تمت الإضافة للسلة!");
            document.getElementById('hIn').value = '';
        }

        // عرض/إخفاء السلة
        function toggleCartModal() {
            const overlay = document.getElementById('cartOverlay');
            overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
            
            if (overlay.style.display === 'flex') {
                let total = 0;
                let html = '';
                
                cart.forEach((item, idx) => {
                    total += item.p;
                    html += `<div class="cart-item" style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid #eee;">
                        <img src="${item.img}" style="width:50px;height:50px;border-radius:8px;object-fit:cover;">
                        <div style="flex:1;"><b>${item.n}</b><br><span style="color:var(--gold)">${item.p.toLocaleString()} د.ع</span></div>
                        <i class="fas fa-trash" style="color:red;cursor:pointer;" onclick="removeFromCart(${idx})"></i>
                    </div>`;
                });
                
                if (cart.length > 0) {
                    html += `<div style="margin-top:15px;font-weight:900;text-align:center;background:#eee;padding:10px;">الإجمالي: ${total.toLocaleString()} د.ع</div>`;
                } else {
                    html = '<p style="text-align:center;padding:20px;">السلة فارغة</p>';
                }
                
                document.getElementById('cartItemsList').innerHTML = html;
            }
        }

        // حذف من السلة
        function removeFromCart(index) { 
            cart.splice(index, 1); 
            document.getElementById('globalCartCount').innerText = cart.length; 
            localStorage.setItem('shababek_cart', JSON.stringify(cart));
            toggleCartModal(); 
        }

        // إرسال الطلب
        function sendOrder() {
            if(cart.length === 0) return alert("السلة فارغة");
            
            const city = document.getElementById('userCity').value;
            const payment = document.getElementById('userPayment').value;
            const install = document.getElementById('userInstall').value;

            let msg = `*طلب شراء جديد من شبابيك للستائر* 🪟\n\n`;
            msg += `📍 *المحافظة:* ${city}\n`;
            msg += `🛠 *خدمة التركيب:* ${install}\n`;
            msg += `💳 *طريقة الدفع:* ${payment}\n`;
            msg += `------------------------------\n\n`;
            
            let total = 0;

            cart.forEach((item, index) => {
                msg += `*${index + 1}- الموديل:* ${item.n}\n`;
                msg += `💰 *السعر:* ${item.p.toLocaleString()} د.ع\n`;
                msg += `🖼 *صورة الموديل:* ${item.img}\n`;
                msg += `------------------------------\n`;
                total += item.p;
            });
            
            msg += `\n💰 *الإجمالي الكلي للطلب:* ${total.toLocaleString()} د.ع\n\n`;
            msg += `_شكراً لاختياركم شبابيك - ظل وذوق_`;

            const waNumber = "9647883002797";
            const waUrl = `https://wa.me/${waNumber}?text=${encodeURIComponent(msg)}`;
            
            window.open(waUrl, '_blank');

            cart = []; 
            document.getElementById('globalCartCount').innerText = "0"; 
            localStorage.setItem('shababek_cart', JSON.stringify(cart));
            toggleCartModal();
        }

        // ===== نظام المستعرض القديم (محذوف ولكن نحتفظ بالدوال للتوافق) =====
        let viewerData = {
            isOpen: false,
            currentIndex: 0,
            mediaItems: [],
            product: null,
            isZoomed: false,
            isAutoPlaying: false,
            autoPlayInterval: null,
            startX: 0,
            isDragging: false
        };

        function openProductViewer(product, mediaItems) { /* kept for compatibility */ }
        function closeViewer() { /* kept for compatibility */ }
        function navigateSlide(direction) { /* kept for compatibility */ }
        function goToSlide(index) { /* kept for compatibility */ }
        function updateSlidePosition() { /* kept for compatibility */ }
        function updateProgressDots() { /* kept for compatibility */ }
        function resetZoom() { /* kept for compatibility */ }
        function setupZoom() { /* kept for compatibility */ }
        function toggleAutoPlay() { /* kept for compatibility */ }
        function startAutoPlay() { /* kept for compatibility */ }
        function stopAutoPlay() { /* kept for compatibility */ }
        function setupTouchEvents() { /* kept for compatibility */ }
        function setupViewerEvents() { /* kept for compatibility */ }
        function addCurrentToCart() { /* kept for compatibility */ }

        // ===== نظام المستعرض الجديد بنظام Alibaba =====
        let alibabaViewerData = {
            isOpen: false,
            currentIndex: 0,
            mediaItems: [],
            product: null,
            isZoomed: false,
            startX: 0,
            isDragging: false
        };

        // فتح المستعرض
        function openAlibabaViewer(product) {
            alibabaViewerData.product = product;
            alibabaViewerData.currentIndex = 0;
            alibabaViewerData.isOpen = true;
            alibabaViewerData.isZoomed = false;
            
            // تجهيز وسائط المنتج
            alibabaViewerData.mediaItems = [
                { type: 'image', url: product.img }
            ];
            
            if (product.video) {
                alibabaViewerData.mediaItems.push({ type: 'video', url: product.video });
            }
            
            const viewer = document.getElementById('alibabaViewer');
            
            // تحديث معلومات المنتج
            document.getElementById('alibabaProductName').textContent = product.name;
            document.getElementById('alibabaProductTitle').textContent = product.name;
            document.getElementById('alibabaProductPrice').textContent = parseInt(product.price).toLocaleString();
            
            // إنشاء رمز المنتج عشوائي
            document.getElementById('alibabaProductCode').textContent = `موديل: ST-${Math.floor(Math.random() * 10000)}`;
            
            // إنشاء التقييمات الوهمية
            document.getElementById('alibabaProductRating').textContent = `4.8 (${Math.floor(Math.random() * 200) + 50} تقييم)`;
            document.getElementById('alibabaProductSold').textContent = `أكثر من ${Math.floor(Math.random() * 500) + 200} قطعة مباعة`;
            
            // إنشاء المواصفات
            const specs = [
                { label: 'الخامة', value: 'قماش فاخر' },
                { label: 'النوع', value: 'بلاك أوت' },
                { label: 'اللون', value: 'متعدد الألوان' },
                { label: 'الضمان', value: 'سنتان' },
                { label: 'التوصيل', value: 'مجاني' },
                { label: 'التركيب', value: 'متوفر' }
            ];
            
            document.getElementById('alibabaProductSpecs').innerHTML = specs.map(s => `
                <div class="alibaba-spec-item">
                    <span class="alibaba-spec-label">${s.label}</span>
                    <span class="alibaba-spec-value">${s.value}</span>
                </div>
            `).join('');
            
            // عرض الصورة الرئيسية
            document.getElementById('alibabaMainImage').src = product.img;
            
            // إنشاء المعرض المصغر
            const gallery = document.getElementById('alibabaThumbnailGallery');
            gallery.innerHTML = alibabaViewerData.mediaItems.map((item, index) => `
                <div class="alibaba-thumbnail ${item.type === 'video' ? 'video-thumb' : ''} ${index === 0 ? 'active' : ''}" 
                     onclick="changeAlibabaSlide(${index})">
                    ${item.type === 'video' 
                        ? `<video src="${item.url}" muted></video>` 
                        : `<img src="${item.url}">`
                    }
                </div>
            `).join('');
            
            // حساب الإجمالي الأولي
            calculateAlibabaTotal();
            
            viewer.classList.add('active');
            
            // إضافة مستمعي الأحداث
            setTimeout(() => setupAlibabaViewerEvents(), 100);
        }

        // إغلاق المستعرض
        function closeAlibabaViewer() {
            document.getElementById('alibabaViewer').classList.remove('active');
            alibabaViewerData.isOpen = false;
        }

        // تغيير الشريحة
        function changeAlibabaSlide(index) {
            if (index < 0 || index >= alibabaViewerData.mediaItems.length) return;
            
            alibabaViewerData.currentIndex = index;
            
            // تحديث الصورة الرئيسية
            const mainImage = document.getElementById('alibabaMainImage');
            const item = alibabaViewerData.mediaItems[index];
            
            if (item.type === 'video') {
                // إذا كان فيديو، نحتاج لتغيير العنصر
                const container = document.getElementById('alibabaMainImageContainer');
                if (mainImage.tagName === 'IMG') {
                    const video = document.createElement('video');
                    video.src = item.url;
                    video.controls = true;
                    video.className = 'alibaba-main-image';
                    video.id = 'alibabaMainImage';
                    container.replaceChild(video, mainImage);
                } else {
                    mainImage.src = item.url;
                }
            } else {
                // إذا كان صورة
                const container = document.getElementById('alibabaMainImageContainer');
                if (mainImage.tagName === 'VIDEO') {
                    const img = document.createElement('img');
                    img.src = item.url;
                    img.className = 'alibaba-main-image';
                    img.id = 'alibabaMainImage';
                    container.replaceChild(img, mainImage);
                } else {
                    mainImage.src = item.url;
                }
            }
            
            // تحديث الثمبنايل
            document.querySelectorAll('.alibaba-thumbnail').forEach((thumb, i) => {
                if (i === index) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
            
            resetAlibabaZoom();
        }

        // حساب الإجمالي
        function calculateAlibabaTotal() {
            const meters = parseFloat(document.getElementById('alibabaMetersInput').value) || 1;
            const price = alibabaViewerData.product ? alibabaViewerData.product.price : 0;
            const total = meters * price;
            document.getElementById('alibabaTotalPrice').textContent = total.toLocaleString() + ' د.ع';
        }

        // إضافة من المستعرض إلى السلة
        function addFromAlibabaViewer() {
            if (!alibabaViewerData.product) return;
            
            const meters = parseFloat(document.getElementById('alibabaMetersInput').value);
            if (!meters || meters <= 0) {
                alert("الرجاء إدخال عدد الأمتار");
                return;
            }
            
            const totalPrice = meters * alibabaViewerData.product.price;
            
            cart.push({ 
                n: alibabaViewerData.product.name, 
                p: Math.round(totalPrice), 
                img: getWatermarkedUrl(alibabaViewerData.product.img),
                length: meters
            });
            
            document.getElementById('globalCartCount').innerText = cart.length; 
            localStorage.setItem('shababek_cart', JSON.stringify(cart));
            alert("تمت الإضافة للسلة!");
        }

        // شراء الآن
        function buyNowFromAlibabaViewer() {
            addFromAlibabaViewer();
            closeAlibabaViewer();
            toggleCartModal();
        }

        // إعادة تعيين التكبير
        function resetAlibabaZoom() {
            alibabaViewerData.isZoomed = false;
            const mainImage = document.getElementById('alibabaMainImage');
            if (mainImage && mainImage.tagName === 'IMG') {
                mainImage.classList.remove('zoomed');
                mainImage.style.transform = 'scale(1)';
            }
            document.getElementById('alibabaZoomLens').style.display = 'none';
        }

        // إعداد التكبير
        function setupAlibabaZoom() {
            const container = document.getElementById('alibabaMainImageContainer');
            const mainImage = document.getElementById('alibabaMainImage');
            const lens = document.getElementById('alibabaZoomLens');
            
            if (!mainImage || mainImage.tagName !== 'IMG') return;
            
            container.addEventListener('mousemove', (e) => {
                if (alibabaViewerData.isZoomed) return;
                
                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                lens.style.display = 'block';
                lens.style.left = (x - 75) + 'px';
                lens.style.top = (y - 75) + 'px';
                
                const percentX = (x / rect.width) * 100;
                const percentY = (y / rect.height) * 100;
                mainImage.style.transformOrigin = `${percentX}% ${percentY}%`;
                mainImage.style.transform = 'scale(2)';
            });
            
            container.addEventListener('mouseleave', () => {
                if (!alibabaViewerData.isZoomed) {
                    lens.style.display = 'none';
                    mainImage.style.transform = 'scale(1)';
                }
            });
            
            container.addEventListener('click', () => {
                alibabaViewerData.isZoomed = !alibabaViewerData.isZoomed;
                if (alibabaViewerData.isZoomed) {
                    mainImage.classList.add('zoomed');
                    lens.style.display = 'none';
                } else {
                    mainImage.classList.remove('zoomed');
                    mainImage.style.transform = 'scale(1)';
                }
            });
        }

        // إعداد أحداث المستعرض
        function setupAlibabaViewerEvents() {
            setupAlibabaZoom();
            
            // تحديث الإجمالي عند تغيير عدد الأمتار
            document.getElementById('alibabaMetersInput').addEventListener('input', calculateAlibabaTotal);
        }

        // إغلاق نتائج البحث عند النقر خارجها
        document.addEventListener('click', (e) => {
            const searchBox = document.querySelector('.search-box');
            const searchRes = document.getElementById('searchRes');
            if (searchBox && searchRes && !searchBox.contains(e.target) && !searchRes.contains(e.target)) {
                searchRes.style.display = 'none';
            }
        });

        // معالجة زر الرجوع
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page) {
                showPage(event.state.page, false); 
            } else {
                showPage('homePage', false);
            }
        });

        // تحميل البيانات
        window.addEventListener('load', () => {
            // الأقسام
            db.ref('categories').on('value', snap => {
                const cats = snap.val() || {};
                const list = document.getElementById('categoriesList');
                if(list) {
                    if (Object.keys(cats).length === 0) {
                        list.innerHTML = '<div style="grid-column:1/-1; text-align:center;">لا توجد أقسام</div>';
                    } else {
                        list.innerHTML = Object.values(cats).map(c => 
                            `<div class="cat-card-new" onclick="openCat('${c.name}')">
                                <img src="${c.img}" style="width:100%;height:100%;object-fit:cover;">
                                <div style="position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:var(--gold);color:white;padding:10px 25px;border-radius:12px;font-weight:900;">${c.name}</div>
                            </div>`
                        ).join('');
                    }
                }
                
                const admListCats = document.getElementById('admListCats');
                if(admListCats) {
                    admListCats.innerHTML = Object.entries(cats).map(([k,v]) => 
                        `<tr><td>${v.name}</td><td><button onclick="deleteItem('categories','${k}')" style="color:red;border:none;background:none;cursor:pointer;">حذف</button></td></tr>`
                    ).join('');
                }
                
                const admProdCatSelect = document.getElementById('admProdCatSelect');
                if(admProdCatSelect) {
                    admProdCatSelect.innerHTML = '<option disabled selected>اختر قسم المنتجات</option>' + 
                        Object.values(cats).map(s => `<option value="${s.name}">${s.name}</option>`).join('');
                }
            });

            // المنتجات
            db.ref('products').on('value', snap => {
                const data = snap.val() || {};
                const list = document.getElementById('admListProds');
                if(list) {
                    list.innerHTML = Object.entries(data).map(([k,v]) => 
                        `<tr><td>${v.name}</td><td><button onclick="deleteItem('products','${k}')" style="color:red;border:none;background:none;cursor:pointer;">حذف</button></td></tr>`
                    ).join('');
                }
            });

            // طرق الدفع
            db.ref('payments').on('value', snap => {
                const data = snap.val() || {};
                const userList = document.getElementById('paymentList');
                const selectBox = document.getElementById('userPayment');

                if(selectBox) {
                    selectBox.innerHTML = Object.values(data).map(pay => 
                        `<option value="${pay.name}">${pay.name}</option>`
                    ).join('') || '<option value="نقد عند الاستلام">نقد عند الاستلام</option>';
                }

                if(userList) {
                    if (Object.keys(data).length === 0) {
                        userList.innerHTML = '<div style="grid-column:1/-1; text-align:center;">لا توجد طرق دفع</div>';
                    } else {
                        userList.innerHTML = Object.values(data).map(pay => `
                            <div class="payment-card">
                                <img src="${pay.img}" style="width:100%; height:100%; object-fit: contain; padding: 20px;">
                                <div class="payment-overlay">${pay.name}</div>
                            </div>
                        `).join('');
                    }
                }
                
                const admListPays = document.getElementById('admListPays');
                if(admListPays) {
                    admListPays.innerHTML = Object.entries(data).map(([k,v]) => 
                        `<tr><td>${v.name}</td><td><button onclick="deleteItem('payments','${k}')" style="color:red;border:none;background:none;cursor:pointer;">حذف</button></td></tr>`
                    ).join('');
                }
            });

            // استعادة آخر صفحة
            const hash = location.hash.replace('#', '');
            if (hash === 'categoryView') {
                const lastCat = localStorage.getItem('lastCat');
                if(lastCat) openCat(lastCat);
            } else if (hash === 'productCalculator') {
                const lastProd = localStorage.getItem('lastProd');
                if(lastProd) openCalc(JSON.parse(lastProd));
            } else {
                showPage(hash || 'homePage', false);
            }

            // تحديث عداد السلة
            document.getElementById('globalCartCount').innerText = cart.length;
        });
    </script>
</body>
</html>
