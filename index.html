<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شبابيك للستائر</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{
--beige:#f5f1ea;
--brown:#6b4f3a;
--gold:#c6a75e;
--gray:#777;
}
body{margin:0;font-family:tahoma;background:var(--beige)}
header{
background:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 2px 10px rgba(0,0,0,.08)
}
.logo{font-size:22px;font-weight:900;color:var(--brown);cursor:pointer}
nav button{
background:none;border:none;
font-weight:700;
color:var(--brown);
cursor:pointer;
margin:0 10px;
font-size:15px
}
.page{display:none;padding:30px}
.active{display:block}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
gap:20px
}
.card{
background:white;
border-radius:14px;
overflow:hidden;
box-shadow:0 4px 15px rgba(0,0,0,.08);
cursor:pointer;
transition:.3s
}
.card:hover{transform:translateY(-5px)}
.card img{
width:100%;
height:220px;
object-fit:cover
}
.card-body{padding:20px;text-align:center}
.price{color:var(--gold);font-weight:900}

input,select{
padding:10px;
width:100%;
margin-bottom:10px;
border:1px solid #ddd;
border-radius:8px
}
button.main{
background:var(--gold);
color:white;
border:none;
padding:12px 20px;
border-radius:8px;
font-weight:900;
cursor:pointer
}
table{width:100%;background:white;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center}
.admin-box{
background:white;
padding:20px;
margin-bottom:25px;
border-radius:12px;
box-shadow:0 2px 10px rgba(0,0,0,.05)
}
</style>
</head>
<body>

<header>
<div class="logo" onclick="handleLogoClick()">شبابيك للستائر</div>
<nav>
<button onclick="showPage('homePage')">الرئيسية</button>
<button onclick="showPage('paymentsPage')">طرق الدفع</button>
</nav>
</header>

<!-- الصفحة الرئيسية -->
<div id="homePage" class="page active">
<h2>الأقسام</h2>
<div id="categoriesList" class="grid"></div>
</div>

<!-- صفحة عرض قسم -->
<div id="categoryView" class="page">
<h2 id="catTitle"></h2>
<div id="catGrid" class="grid"></div>
</div>

<!-- صفحة الدفع -->
<div id="paymentsPage" class="page">
<h2>طرق الدفع</h2>
<div id="paymentList" class="grid"></div>
</div>

<!-- لوحة التحكم -->
<div id="adminPanel" class="page">
<h2>لوحة التحكم</h2>

<div class="admin-box">
<h3>إضافة قسم</h3>
<input id="admCatName" placeholder="اسم القسم">
<input id="admCatFile" type="file">
<button class="main" onclick="publishCat()">نشر</button>
<table>
<thead><tr><th>القسم</th><th>حذف</th></tr></thead>
<tbody id="admListCats"></tbody>
</table>
</div>

<div class="admin-box">
<h3>إضافة منتج</h3>
<input id="admProdName" placeholder="اسم المنتج">
<input id="admProdPrice" placeholder="السعر">
<select id="admProdCatSelect"></select>
<input id="admProdFile" type="file">
<button class="main" onclick="publishProd()">نشر</button>
</div>

<div class="admin-box">
<h3>طرق الدفع</h3>
<input id="admPayName" placeholder="اسم طريقة الدفع">
<input id="admPayFile" type="file">
<button class="main" onclick="publishPayment()">نشر</button>
<table>
<thead><tr><th>الاسم</th><th>حذف</th></tr></thead>
<tbody id="admListPays"></tbody>
</table>
</div>

</div>

<script>
// Firebase
const firebaseConfig = {
apiKey:"YOUR_API_KEY",
authDomain:"YOUR_AUTH_DOMAIN",
databaseURL:"YOUR_DATABASE_URL",
projectId:"YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// الصفحات
function showPage(id,push=true){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.getElementById(id).classList.add('active');
window.scrollTo(0,0);
if(push)history.pushState({page:id},"",`?page=${id}`);
localStorage.setItem("page",id);
}
window.addEventListener("load",()=>{
const url=new URLSearchParams(location.search);
showPage(url.get("page")||localStorage.getItem("page")||"homePage",false);
});
window.addEventListener("popstate",e=>{
showPage(e.state?.page||"homePage",false);
});

// دخول الادمن
let clicks=0,timer;
function handleLogoClick(){
clicks++;
clearTimeout(timer);
if(clicks>=5){
clicks=0;
if(prompt("رمز الدخول؟")==="8496")showPage("adminPanel");
return;
}
timer=setTimeout(()=>{clicks=0},400);
}

// رفع صورة
async function uploadImg(file){
const fd=new FormData();
fd.append("file",file);
fd.append("upload_preset","afsx4w9k");
const r=await fetch("https://api.cloudinary.com/v1_1/dnkuwf8q9/image/upload",{method:"POST",body:fd});
return (await r.json()).secure_url;
}

// الأقسام
async function publishCat(){
const n=admCatName.value,f=admCatFile.files[0];
if(!n||!f)return alert("أكمل البيانات");
db.ref("categories").push({name:n,img:await uploadImg(f)});
}
db.ref("categories").on("value",s=>{
const d=s.val()||{};
categoriesList.innerHTML=Object.entries(d).map(([k,v])=>`
<div class="card" onclick="openCat('${v.name}')">
<img src="${v.img}">
<div class="card-body"><h3>${v.name}</h3></div>
</div>`).join('');
admListCats.innerHTML=Object.entries(d).map(([k,v])=>`
<tr><td>${v.name}</td>
<td><button onclick="deleteItem('categories','${k}')">حذف</button></td></tr>`).join('');
admProdCatSelect.innerHTML='<option disabled selected>اختر قسم</option>'+
Object.values(d).map(c=>`<option>${c.name}</option>`).join('');
});

// المنتجات
async function publishProd(){
const n=admProdName.value,p=admProdPrice.value,
c=admProdCatSelect.value,f=admProdFile.files[0];
if(!n||!p||!c||!f)return alert("أكمل البيانات");
db.ref("products").push({name:n,price:p,category:c,img:await uploadImg(f)});
}
function openCat(name){
db.ref("products").once("value",s=>{
const items=Object.values(s.val()||{}).filter(x=>x.category===name);
catTitle.innerText=name;
catGrid.innerHTML=items.map(p=>`
<div class="card">
<img src="${p.img}">
<div class="card-body">
<h3>${p.name}</h3>
<div class="price">${parseInt(p.price).toLocaleString()} د.ع</div>
</div></div>`).join('');
showPage("categoryView");
});
}

// الدفع
async function publishPayment(){
const n=admPayName.value,f=admPayFile.files[0];
if(!n||!f)return alert("أكمل البيانات");
db.ref("payments").push({name:n,img:await uploadImg(f)});
}
db.ref("payments").on("value",s=>{
const d=s.val()||{};
paymentList.innerHTML=Object.entries(d).map(([k,v])=>`
<div class="card">
<img src="${v.img}">
<div class="card-body"><h3>${v.name}</h3></div>
</div>`).join('');
admListPays.innerHTML=Object.entries(d).map(([k,v])=>
`<tr><td>${v.name}</td>
<td><button onclick="deleteItem('payments','${k}')">حذف</button></td></tr>`).join('');
});

// حذف عام
function deleteItem(r,k){
if(confirm("تأكيد الحذف؟"))db.ref(r).child(k).remove();
}
</script>

</body>
</html>
