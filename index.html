<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شبابيك للستائر - Shababek Curtains</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/3y1ZNCk0/1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root { --gold: #d9b382; --brown: #3d2e24; --bg: #f9f6f2; --white: #ffffff; --whatsapp: #25D366; --red: #ff4d4d; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--white); color: var(--brown); overflow-x: hidden; scroll-behavior: smooth; line-height: 1.6; }

        .top-banner { background: var(--brown); color: white; padding: 10px 5%; text-align: center; font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
        .wa-link { color: var(--whatsapp); text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 5px; }

        header { background: var(--white); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .logo-center { flex: 1; display: flex; justify-content: center; cursor: pointer; }
        .logo-img { height: 90px; transition: 0.3s; }
        
        .header-left { flex: 1; display: flex; justify-content: flex-end; align-items: center; gap: 15px; }
        .cart-icon { position: relative; cursor: pointer; font-size: 2.2rem; color: var(--brown); background: white; padding: 5px; border-radius: 12px; transition: 0.3s; border: 1px solid #eee; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: var(--red); color: white; font-size: 0.85rem; padding: 2px 8px; border-radius: 50%; font-weight: 900; }
        
        .search-box { position: relative; width: 40px; height: 40px; transition: 0.4s; overflow: hidden; border: 1px solid #eee; border-radius: 12px; display: flex; align-items: center; }
        .search-box:hover, .search-box:focus-within { width: 180px; border-color: var(--gold); }
        .search-box input { border: none; outline: none; background: transparent; padding: 10px; width: 140px; font-size: 0.9rem; }
        .search-box i { padding: 10px; color: var(--brown); cursor: pointer; }

        .nav-bar { background: #fcfcfc; border-bottom: 1px solid #eee; padding: 12px 0; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-menu { display: inline-flex; gap: 25px; list-style: none; padding: 0 20px; }
        .nav-menu a { text-decoration: none; color: var(--brown); font-weight: 700; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .nav-menu a:hover { color: var(--gold); }

        .page { display: none; width: 100%; animation: fadeIn 0.4s ease; }
        .active { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #cartOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .cart-modal { background: var(--white); width: 90%; max-width: 500px; border-radius: 30px; padding: 35px; position: relative; max-height: 90vh; overflow-y: auto; }
        .cart-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; }

        .hero { height: 70vh; background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.3)), url('https://i.ibb.co/0R1MK2d7/Gemini-Generated-Image-tnocdatnocdatnoc.png'); background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; padding: 20px; }
        .hero h1 { font-size: clamp(1.8rem, 5vw, 3.5rem); font-weight: 900; margin-bottom: 25px; text-shadow: 0 2px 15px rgba(0,0,0,0.4); }
        .hero-btns { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 320px; margin-bottom: 30px; }
        .btn-gold { background: var(--gold); color: white; border: none; padding: 16px 35px; border-radius: 12px; font-weight: 900; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        .btn-trans { background: transparent; color: white; border: 2px solid white; padding: 16px 35px; border-radius: 12px; font-weight: 900; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }

        .social-hero { display: flex; gap: 20px; }
        .social-hero a { color: var(--white); font-size: 1.8rem; transition: 0.4s; }
        .social-hero a:hover { color: var(--gold); transform: translateY(-8px) scale(1.2); }

        .features-section { background: var(--bg); padding: 50px 5%; text-align: center; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; max-width: 1200px; margin: auto; }
        .f-card { background: white; padding: 25px 15px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); transition: 0.3s; }
        .f-card:hover { transform: translateY(-5px); border: 1px solid var(--gold); }

        .stat-grid { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .stat-card { background: #f4f1ed; padding: 25px; border-radius: 20px; text-align: center; }
        .stat-num { font-size: 2.2rem; font-weight: 900; color: var(--gold); display: block; }

        .footer-cta { background: var(--brown); color: white; padding: 40px 5%; text-align: center; border-radius: 40px 40px 0 0; }
        .footer-cta h2 { font-size: 1.6rem; font-weight: 900; margin-bottom: 10px; }
        .btn-footer-wa { background: transparent; border: 1px solid rgba(255,255,255,0.4); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; margin: 5px; font-weight: 600; font-size: 0.9rem; }
        .btn-footer-prod { background: var(--gold); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; margin: 5px; font-weight: 600; font-size: 0.9rem; }

        .admin-box { background: #f4f4f4; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: right; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 10px; overflow: hidden; font-size: 0.85rem; }
        .admin-table td { padding: 10px; border-bottom: 1px solid #eee; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; font-family: 'Cairo'; }

        footer { background: var(--brown); color: rgba(255,255,255,0.6); padding: 20px 5%; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; }
        
        .doc-list-btn { background: white; padding: 20px; border-radius: 15px; margin-bottom: 10px; cursor: pointer; border: 1px solid #eee; font-weight: 700; transition: 0.3s; }
        
        /* مشغلات الفيديو المطورة */
        .vid-frame-wide { position: relative; padding-top: 56.25%; background: #000; border-radius: 20px; overflow: hidden; margin-bottom: 15px; width: 100%; }
        .reel-container { position: relative; padding-top: 177.7%; background: #000; border-radius: 20px; overflow: hidden; }
        .auto-video, .vid-frame-wide iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        
        #searchRes { position: absolute; top: 110px; left: 5%; width: 90%; background: white; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 20px; padding: 15px; display: none; }
  /* حل مشكلة التمرير وتنسيق الصور في المتصفح */
.admin-table {
    width: 100%;
    table-layout: fixed; /* يمنع التمدد الجانبي */
}
.admin-table img {
    width: 60px !important; 
    height: 60px !important;
    object-fit: cover;
    border-radius: 8px;
}
.admin-table td {
    word-wrap: break-word;
    font-size: 0.8rem;
}
   /* تنسيق ذكي: شبكة للمتصفح وتمرير للهاتف */
#categoriesList {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 أقسام في السطر للمتصفح */
    gap: 20px;
    padding: 20px 5%;
}

@media (max-width: 768px) {
    #categoriesList {
        display: flex; /* العودة لنظام الصف للهاتف */
        grid-template-columns: none;
        overflow-x: auto; /* تفعيل التمرير الجانبي */
        gap: 15px;
        padding: 20px;
        scrollbar-width: none;
    }
    #categoriesList div {
        flex: 0 0 250px; /* عرض ثابت لكل قسم ليسمح بالتمرير */
    }
}

/* تنسيق الكارت ليكون أنيقاً */
.cat-card-new {
    position: relative;
    height: 350px;
    border-radius: 20px;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
 /* تنسيق المتصفح (الكمبيوتر) - شبكة 5 في كل سطر */
#categoriesList {
    display: grid !important;
    grid-template-columns: repeat(5, 1fr); 
    gap: 15px;
    padding: 20px 5%;
}

/* تنسيق الهاتف - تمرير جانبي حصراً */
@media (max-width: 768px) {
    #categoriesList {
        display: flex !important; /* إجبار الهاتف على وضع الأقسام في صف واحد */
        grid-template-columns: none !important;
        overflow-x: auto !important; /* تفعيل التمرير */
        scroll-snap-type: x mandatory;
        gap: 15px;
        padding: 20px;
        -webkit-overflow-scrolling: touch;
    }
    
    #categoriesList .cat-card-new {
        flex: 0 0 250px !important; /* منع انضغاط الصور وإجبارها على العرض الكامل */
        height: 300px;
        scroll-snap-align: start;
    }
}
    </style>
</head>
<body>

    <div class="top-banner">
        <span>شبابيك للستائر - ظل وذوق</span>
        <a href="https://wa.me/9647883002797" class="wa-link"><i class="fab fa-whatsapp"></i> تواصل عبر الواتساب</a>
    </div>

    <header>
        <div style="font-weight:900; line-height:1; flex:1;">شبابيك<br><span style="color:var(--gold); font-size:1rem;">للستائر</span></div>
        <div class="logo-center" onclick="handleLogoClick()"><img src="https://i.ibb.co/3y1ZNCk0/1.png" class="logo-img"></div>
        <div class="header-left">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="ابحث عن موديل.." onkeyup="handleSearch()">
            </div>
            <div class="cart-icon" onclick="toggleCartModal()">
                <i class="fas fa-shopping-basket"></i>
                <span id="globalCartCount" class="cart-count">0</span>
            </div>
        </div>
    </header>
    
    <div id="searchRes"></div>

    <div class="nav-bar">
        <ul class="nav-menu">
            <li><a onclick="showPage('homePage')">الرئيسية</a></li>
            <li><a onclick="showPage('homePage'); setTimeout(() => { document.getElementById('categories').scrollIntoView({behavior: 'smooth'}); }, 100);">المنتجات</a></li>
            <li><a href="ai.html">منتدى شبابيك</a></li>
            <li><a onclick="showPage('paymentPage')">طرق الدفع</a></li>
            <li><a onclick="showPage('aboutPage')">من نحن</a></li>
            <li><a onclick="showPage('contactPage')">تواصل معنا</a></li>
        </ul>
    </div>

    <div id="cartOverlay">
        <div class="cart-modal">
            <h2 style="margin-bottom:20px; border-bottom:2px solid var(--gold); padding-bottom:10px; font-weight:900;">سلة المشتريات</h2>
            <div id="cartItemsList"></div>
            
            <div id="checkoutFields" style="margin-top:20px; border-top:2px solid var(--gold); padding-top:15px;">
                <label style="font-weight:bold; font-size:0.9rem;">المحافظة:</label>
                <select id="userCity">
                    <option value="بغداد">بغداد</option><option value="البصرة">البصرة</option><option value="نينوى">نينوى</option><option value="أربيل">أربيل</option><option value="النجف">النجف</option><option value="كربلاء">كربلاء</option><option value="بابل">بابل</option><option value="الأنبار">الأنبار</option><option value="ذي قار">ذي قار</option><option value="ديالى">ديالى</option><option value="ميسان">ميسان</option><option value="واسط">واسط</option><option value="المثنى">المثنى</option><option value="كركوك">كركوك</option><option value="صلاح الدين">صلاح الدين</option><option value="دهوك">دهوك</option><option value="السليمانية">السليمانية</option><option value="القادسية">القادسية</option>
                </select>
                <label style="font-weight:bold; font-size:0.9rem; margin-top:10px; display:block;">طريقة الدفع:</label>
               <select id="userPayment"></select>
                </select>
            </div>

            <div style="margin-top:20px;">
                <button class="btn-gold" style="width:100%; padding:20px;" onclick="sendOrder()">إرسال الطلب عبر واتساب</button>
                <p onclick="toggleCartModal()" style="margin-top:20px; text-align:center; color:#999; cursor:pointer; font-weight:bold;">إغلاق</p>
            </div>
        </div>
    </div>

    <main id="mainContainer">
        <div id="homePage" class="page active">
            <section class="hero">
                <h1>فخامة التفاصيل تبدأ من شبابيك منزلك</h1>
                <div class="hero-btns">
                    <button onclick="document.getElementById('categories').scrollIntoView()" class="btn-gold">احسب سعر ستائرك الآن</button>
                    <a href="https://wa.me/9647883002797" class="btn-trans"><i class="fab fa-whatsapp"></i> استشارة مجانية</a>
                </div>
                <div class="social-hero">
                    <a href="https://www.facebook.com/profile.php?id=61587692021311" target="_blank"><i class="fab fa-facebook"></i></a>
                    <a href="https://www.instagram.com/shababek.curtains/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.tiktok.com/@shababek.curtains" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a href="https://youtube.com/@shababek.curtains?si=KKsEbL98N0fq2e2U" target="_blank"><i class="fab fa-youtube"></i></a>
                    <a href="https://x.com/ShababekCurtain" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                    <a href="https://www.snapchat.com/add/shababekcurtin?share_id=B2Prmbx5_Xo&locale=en-IQ" target="_blank"><i class="fab fa-snapchat"></i></a>
                </div>
            </section>
            <section id="categories" style="padding: 40px 0;">
                <h2 style="text-align:center; font-weight:900; margin-bottom:15px;">أقسامنا المميزة</h2>
                <div id="categoriesList" style="display:flex; overflow-x:auto; gap:20px; padding:20px 5%; scrollbar-width:none;"></div>
            </section>
            <section class="features-section">
                <h2 style="margin-bottom:35px; font-weight:900;">لماذا شبابيك؟</h2>
                <div class="features-grid">
                    <div class="f-card"><i class="fa-solid fa-shield-halved" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>ضمان حقيقي</h3><p>أرقى الأقمشة بضمان رسمي.</p></div>
                    <div class="f-card">
    <i class="fa-solid fa-tools" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i>
    <h3>تركيب احترافي</h3>
    <p>فريقنا المتخصص يضمن لك تركيباً متقناً ونظيفاً.</p>
</div>
                    <div class="f-card"><i class="fa-solid fa-ruler-combined" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>تفصيل دقيق</h3><p>خياطة احترافية حسب الطلب.</p></div>
                    <div class="f-card"><i class="fa-solid fa-palette" style="color:var(--gold); font-size:2.2rem; margin-bottom:10px;"></i><h3>ذوق رفيع</h3><p>أحدث الموديلات العصرية.</p></div>
                </div>
            </section>
        </div>

       <div class="admin-box" style="border:2px solid var(--gold);">
    <h3>٣. إدارة منتدى شبابيك</h3>
    <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">انشر المواضيع والصور والفيديوهات لتظهر في صفحة ai.html</p>
    
    <select id="admForumSection">
        <option value="موديلات جديدة">موديلات جديدة</option>
        <option value="نصائح ديكور">نصائح ديكور</option>
        <option value="آراء الزبائن">آراء الزبائن</option>
    </select>
    
    <textarea id="admForumText" placeholder="اكتب نصيحة أو خبر جديد لزبائن شبابيك..."></textarea>
    
    <select id="admForumType">
        <option value="text">نص فقط</option>
        <option value="image">صورة</option>
        <option value="youtube">فيديو يوتيوب</option>
    </select>
    
    <input type="text" id="admForumUrl" placeholder="رابط الصورة أو رابط اليوتيوب">
    
    <button onclick="publishToForum()" class="btn-gold" id="btnForum" style="margin-top: 10px;">نشر في منتدى شبابيك</button>
    
    <table class="admin-table">
        <thead>
            <tr>
                <th>الموضوع</th>
                <th>القسم</th>
                <th>إجراء</th>
            </tr>
        </thead>
        <tbody id="admListForum"></tbody>
    </table>
</div>

        <div id="docInsidePage" class="page">
            <div style="padding: 40px 5%; max-width: 600px; margin: auto;">
                <h2 id="currentDocTitle" style="text-align:center; margin-bottom:30px; color:var(--gold);"></h2>
                <div id="docTopicsList"></div>
                <button onclick="showPage('doctorPage')" class="btn-gold" style="width:100%; margin-top:20px; background:var(--brown);">العودة</button>
            </div>
        </div>

        <div id="adminPanel" class="page">
            <div style="padding: 40px 5%; max-width: 900px; margin: auto;">
                <h2 style="text-align:center; margin-bottom:40px; font-weight:900;">لوحة الإدارة السحابية</h2>
                <div class="admin-box">
                    <h3>١. إدارة الأقسام</h3>
                    <input type="text" id="admCatName" placeholder="اسم القسم">
                   <input type="file" id="admCatFile" accept="image/*" style="margin: 10px 0; width: 100%;">
<button onclick="publishCat()" class="btn-gold">حفظ القسم</button>

                    <table class="admin-table"><tbody id="admListCats"></tbody></table>
                </div>
                <div class="admin-box">
                    <h3>٢. إدارة المنتجات</h3>
                   <select id="admProdCatSelect"></select>
                    <input type="text" id="admProdName" placeholder="اسم الموديل">
                    <input type="number" id="admProdPrice" placeholder="السعر">
                    <input type="file" id="admProdFile" accept="image/*" style="margin: 10px 0; width: 100%;">
<button onclick="publishProd()" class="btn-gold">نشر المنتج</button>
                    <table class="admin-table"><tbody id="admListProds"></tbody></table>
                </div>
                <div class="admin-box" style="border:2px solid var(--gold);">
                    <h3>٣. إدارة دكتور ديكور</h3>
                    <input type="text" id="admDocSecName" placeholder="اسم القسم الفرعي">
                    <button onclick="saveItem('docSections', {name:v('admDocSecName')})" class="btn-gold">إضافة قسم</button>
                    <table class="admin-table"><tbody id="admListDocSecs"></tbody></table>
                    <hr>
                    <select id="selectDocTopicSec"></select>
                    <input type="text" id="admDocTitle" placeholder="العنوان">
                    <textarea id="admDocDesc" placeholder="الشرح"></textarea>
                    <input type="text" id="admDocMedia" placeholder="رابط ميديا">
                    <select id="admDocType"><option value="img">صورة</option><option value="vid">يوتيوب عادي</option><option value="shorts">يوتيوب شورتس</option></select>
                    <select id="admDocMode"><option value="closed">مقالة (بالضغط)</option><option value="open">مباشر (سكرول)</option></select>
                    <button onclick="saveItem('docTopics', {section:v('admDocTopicSec'), title:v('admDocTitle'), desc:v('admDocDesc'), media:v('admDocMedia'), type:v('admDocType'), mode:v('admDocMode')})" class="btn-gold">نشر</button>
                    <table class="admin-table"><tbody id="admListDocTopics"></tbody></table>
                </div>
                <div class="admin-box">
                    <h3>٤. طرق الدفع</h3>
                    <input type="text" id="admPayName" placeholder="اسم الطريقة">
                    <input type="file" id="admPayFile" accept="image/*" style="margin: 10px 0; width: 100%;">
<button onclick="publishPayment()" class="btn-gold">حفظ طريقة الدفع</button>
                    <table class="admin-table"><tbody id="admListPays"></tbody></table>
                </div>
            </div>
        </div>

        <div id="aboutPage" class="page"><div style="padding: 60px 5%; max-width: 1100px; margin: auto;"><h2 style="font-weight:900; font-size:2.5rem; margin-bottom:30px; text-align:center;">شبابيك للستائر</h2><p style="font-size:1.2rem; line-height:2.2; color:#444; text-align:justify;">تأسست شبابيك للستائر بهدف تقديم أفخم وأجود أنواع الستائر المنزلية في العراق. نؤمن بأن الستائر ليست مجرد قطعة قماش، بل هي عنصر أساسي في تصميم المنزل يعكس ذوق أصحابه ويضيف لمسة من الأناقة والفخامة.

نقدم مجموعة واسعة من الستائر تشمل البلاك أوت والشفافة والديكورية وستائر الرول، بأقمشة مستوردة من أفضل المصانع العالمية. كما نوفر خدمة التفصيل حسب المقاسات وخدمة التركيب المنزلي بأيدي فنيين متخصصين.

رؤيتنا هي أن نكون الوجهة الأولى للستائر الفاخرة في العراق، ونسعى دائماً لتحقيق رضا عملائنا من خلال الجودة العالية والأسعار المنافسة والخدمة المتميزة....</p><div class="stat-grid"><div class="stat-card"><span class="stat-num">500+</span><p>عميل سعيد</p></div><div class="stat-card"><span class="stat-num">50+</span><p>تصميم حصري</p></div><div class="stat-card"><span class="stat-num">10+</span><p>سنوات خبرة</p></div></div></div></div>
        <div id="contactPage" class="page"><div style="padding: 60px 5%; text-align: center; background: var(--bg); border-radius: 40px; margin: 40px 5%;"><h2 style="margin-bottom:30px; font-weight: 900; font-size: 2.2rem;">تواصل معنا</h2><div><i class="fa-solid fa-phone"></i> 07883002797</div><div style="margin-top:10px;"><i class="fa-solid fa-location-dot"></i> العراق - بغداد</div><a href="https://wa.me/9647883002797" class="btn-gold" style="display:inline-block; text-decoration:none; margin-top:20px;">مراسلة واتساب مباشر</a></div></div>
        <div id="categoryView" class="page"><h2 id="catTitle" style="text-align:center; padding:40px 0; font-weight:900;"></h2><div id="catGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:25px; padding:0 5%;"></div></div>
        <div id="productCalculator" class="page"><div style="padding:40px 5%; max-width:650px; margin:auto; text-align:center;"><img id="pImg" src="" style="width:100%; border-radius:25px; margin-bottom:25px;"><h2 id="pName"></h2><div style="color:var(--gold); font-size:1.8rem; font-weight:900; margin-bottom:30px;"><span id="pPrice"></span> د.ع / متر</div><input type="number" id="hIn" placeholder="أدخل الطول بالمتر" style="text-align:center;"><button onclick="addToCart()" class="btn-gold" style="width:100%;">إضافة للسلة</button><button onclick="toggleCartModal()" style="background:transparent; border:2px solid var(--gold); color:var(--gold); width:100%; padding:18px; border-radius:12px; margin-top:10px;">إتمام الطلب الآن</button></div></div>
        <div id="paymentPage" class="page"><div id="paymentList" style="padding: 40px 5%; max-width: 850px; margin: auto;"></div></div>
    </main>

    <div class="footer-cta">
        <h2>جاهز لتجديد ستائر منزلك؟</h2>
        <div style="display:flex; justify-content:center; flex-wrap:wrap; gap:10px;">
            <a href="https://wa.me/9647883002797" class="btn-footer-wa">تواصل عبر واتساب</a>
            <a onclick="showPage('homePage'); document.getElementById('categories').scrollIntoView()" class="btn-footer-prod">تصفح المنتجات</a>
        </div>
    </div>

    <footer><div style="font-size:1.8rem; font-weight:900; color:var(--gold); margin-bottom:10px;">شبابيك</div><p>© 2026 جميع الحقوق محفوظة لشبابيك للستائر - ظل وذوق</p></footer>
<script>
// 1. تهيئة Firebase
const firebaseConfig = { 
    apiKey: "AIzaSyD1TENeV6RkWmrYIjV6seGx84VavsM_tvE", 
    authDomain: "shababekcurtain.firebaseapp.com", 
    databaseURL: "https://shababekcurtain-default-rtdb.asia-southeast1.firebasedatabase.app/", 
    projectId: "shababekcurtain" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const CLOUD_NAME = "dnkuwf8q9", UPLOAD_PRESET = "afsx4w9k", LOGO_ID = "shababek_logo";
let cur = null, cart = [], adminClicks = 0;

function v(id) { return document.getElementById(id).value; }

// --- ٢. محرك الصور والعلامة المائية ---
function getWatermarkedUrl(url) {
    if (!url || !url.includes("cloudinary.com")) return url;
    return url.replace("/upload/", `/upload/l_${LOGO_ID},o_25,w_250,g_center/`);
}

async function uploadImg(file) {
    if (!file) return "";
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: formData });
    const data = await res.json();
    return data.secure_url;
}

// --- ٣. نظام التنقل والهاش ---
function showPage(id, push = true) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const targetPage = document.getElementById(id);
    if (targetPage) {
        targetPage.classList.add('active');
        window.scrollTo(0, 0);
        if (push) location.hash = id; 
    }
}

function handleLogoClick() { 
    adminClicks++; 
    if(adminClicks >= 5) { 
        if(prompt("الرمز:") === "8496") showPage('adminPanel'); 
        adminClicks = 0; 
    } else { showPage('homePage'); } 
}

// --- ٤. وظائف لوحة التحكم ---
db.ref('categories').on('value', snap => {
    const cats = snap.val() || {};
    const admListCats = document.getElementById('admListCats');
    if(admListCats) admListCats.innerHTML = Object.entries(cats).map(([k,v]) => `<tr><td>${v.name}</td><td><button onclick="deleteItem('categories','${k}')" style="color:red; border:none; background:none;">حذف</button></td></tr>`).join('');
    const admProdCatSelect = document.getElementById('admProdCatSelect');
    if(admProdCatSelect) admProdCatSelect.innerHTML = '<option disabled selected>اختر قسم المنتجات</option>' + Object.values(cats).map(s => `<option>${s.name}</option>`).join('');
});

db.ref('products').on('value', snap => {
    const data = snap.val() || {};
    const admListProds = document.getElementById('admListProds');
    if(admListProds) admListProds.innerHTML = Object.entries(data).map(([k,v]) => `<tr><td>${v.name}</td><td><button onclick="deleteItem('products','${k}')" style="color:red; border:none; background:none;">حذف</button></td></tr>`).join('');
});

function deleteItem(ref, key) { if(confirm("حذف؟")) db.ref(ref).child(key).remove(); }

async function publishCat() {
    const fileInput = document.getElementById('admCatFile');
    if(!fileInput.files[0] || !v('admCatName')) return alert("أكمل البيانات");
    const url = await uploadImg(fileInput.files[0]);
    db.ref('categories').push({name: v('admCatName'), img: url}).then(() => location.reload());
}

async function publishProd() {
    const fileInput = document.getElementById('admProdFile');
    if(!fileInput.files[0] || !v('admProdName') || !v('admProdPrice')) return alert("أكمل البيانات");
    const url = await uploadImg(fileInput.files[0]);
    db.ref('products').push({ category: v('admProdCatSelect'), name: v('admProdName'), price: v('admProdPrice'), img: url }).then(() => location.reload());
}

// وظيفة النشر في المنتدى
async function publishToForum() {
    const text = v('admForumText');
    const section = v('admForumSection');
    const type = v('admForumType'); 
    const mediaUrl = v('admForumUrl');
    const btn = document.getElementById('btnForum');

    if(!text || !section) return alert("يرجى كتابة نص الموضوع واختيار القسم");

    btn.innerText = "جاري النشر...";
    btn.disabled = true;

    const postData = {
        section: section,
        text: text,
        media: mediaUrl,
        type: type,
        date: new Date().toLocaleString('ar-EG'),
        timestamp: Date.now()
    };

    db.ref('forum').push(postData).then(() => {
        alert("تم النشر بنجاح!");
        location.reload();
    }).catch(err => {
        alert("فشل النشر: " + err.message);
        btn.disabled = false;
        btn.innerText = "نشر في منتدى شبابيك";
    });
}

// تحديث قائمة المواضيع في لوحة التحكم للحذف
db.ref('forum').on('value', snap => {
    const posts = snap.val() || {};
    const list = document.getElementById('admListForum');
    if(list) {
        list.innerHTML = Object.entries(posts).reverse().map(([k, v]) => `
            <tr>
                <td style="font-size:0.7rem;">${v.text.substring(0, 20)}...</td>
                <td>${v.section}</td>
                <td><button onclick="deleteItem('forum','${k}')" style="color:red; border:none; background:none; cursor:pointer;">حذف</button></td>
            </tr>
        `).join('');
    }
});

                const data = await res.json();
                avatar.src = "https://i.ibb.co/q3z1RscN/Neutral-removebg-preview.png";
                
                if (data && data.candidates) {
                    status.innerText = "هذه توصية دكتور ديكور:";
                    box.innerHTML = `<div style="background:white;padding:15px;border-radius:12px;border-right:5px solid var(--gold);line-height:1.9;">${data.candidates[0].content.parts[0].text}</div>`;
                    confetti({ particleCount: 150 });
                }
            };
        };
    } catch (err) {
        status.innerText = "فشل التحليل";
        box.innerHTML = "تأكد من الإنترنت وحاول مجدداً.";
    }
}

// --- ٦. نظام السلة والعرض ---
function openCat(n) { 
    localStorage.setItem('lastCat', n);
    db.ref('products').once('value', snap => { 
        const items = Object.values(snap.val() || {}).filter(i => i.category === n); 
        document.getElementById('catTitle').innerText = n; 
        document.getElementById('catGrid').innerHTML = items.map(x => `
            <div class="cat-card-new" onclick='openCalc(${JSON.stringify(x)})'>
                <img src="${x.img}" style="width:100%;height:250px;object-fit:cover;">
                <div style="padding:20px;text-align:center;">
                    <h3>${x.name}</h3>
                    <p style="color:var(--gold);font-weight:900;">${parseInt(x.price).toLocaleString()} د.ع</p>
                </div>
            </div>`).join(''); 
        showPage('categoryView'); 
    }); 
}

function openCalc(p) { 
    cur = p; 
    localStorage.setItem('lastProd', JSON.stringify(p));
    showPage('productCalculator'); 
    document.getElementById('pName').innerText = p.name; 
    document.getElementById('pPrice').innerText = parseInt(p.price).toLocaleString(); 
    document.getElementById('pImg').src = getWatermarkedUrl(p.img); 
}

function addToCart() {
    const h = v('hIn');
    if(!h || h <= 0) return alert("أدخل الطول");
    cart.push({ n: cur.name, p: Math.round(h * cur.price), img: getWatermarkedUrl(cur.img) });
    document.getElementById('globalCartCount').innerText = cart.length;
    alert("تمت الإضافة!");
}

function toggleCartModal() {
    const o = document.getElementById('cartOverlay');
    o.style.display = o.style.display === 'flex' ? 'none' : 'flex';
    let total = 0;
    document.getElementById('cartItemsList').innerHTML = cart.map((i, idx) => {
        total += i.p;
        return `<div class="cart-item" style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid #eee;">
            <img src="${i.img}" style="width:50px;height:50px;border-radius:8px;object-fit:cover;">
            <div style="flex:1;"><b>${i.n}</b><br><span style="color:var(--gold)">${i.p.toLocaleString()} د.ع</span></div>
            <i class="fas fa-trash" style="color:red;cursor:pointer;" onclick="removeFromCart(${idx})"></i>
        </div>`;
    }).join('') || '<p style="text-align:center;padding:20px;">السلة فارغة</p>';
    if(cart.length > 0) document.getElementById('cartItemsList').innerHTML += `<div style="margin-top:15px;font-weight:900;text-align:center;background:#eee;padding:10px;">الإجمالي: ${total.toLocaleString()} د.ع</div>`;
}

function removeFromCart(idx) { cart.splice(idx, 1); document.getElementById('globalCartCount').innerText = cart.length; toggleCartModal(); }

function sendOrder() {
    if(cart.length === 0) return alert("السلة فارغة");
    let msg = `طلب جديد من شبابيك:\n`;
    cart.forEach((i, x) => msg += `${x+1}- ${i.n}: ${i.p.toLocaleString()} د.ع\n`);
    window.location.href = `https://wa.me/9647883002797?text=${encodeURIComponent(msg)}`;
    cart = []; document.getElementById('globalCartCount').innerText = "0"; toggleCartModal();
}

function handleSearch() {
    const q = v('searchInput').toLowerCase();
    const res = document.getElementById('searchRes');
    if(q.length < 2) return res.style.display = 'none';
    db.ref('products').once('value', snap => {
        const found = Object.values(snap.val() || {}).filter(p => p.name.toLowerCase().includes(q));
        res.innerHTML = found.map(p => `<div onclick='openCalc(${JSON.stringify(p)}); document.getElementById("searchRes").style.display="none"' style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;">${p.name}</div>`).join('');
        res.style.display = 'block';
    });
}

// --- ٧. المحرك الرئيسي ---
function loadInitialData() {
    db.ref('categories').on('value', snap => {
        const cats = snap.val() || {};
        const list = document.getElementById('categoriesList');
        if(list) list.innerHTML = Object.values(cats).map(c => `
            <div class="cat-card-new" onclick="openCat('${c.name}')">
                <img src="${c.img}" style="width:100%;height:100%;object-fit:cover;">
                <div style="position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:var(--gold);color:white;padding:10px 25px;border-radius:12px;font-weight:900;">${c.name}</div>
            </div>`).join('');
    });
}

window.addEventListener('load', () => {
    loadInitialData();
    const hash = location.hash.replace('#', '');
    if (hash === 'categoryView') openCat(localStorage.getItem('lastCat'));
    else if (hash === 'productCalculator') openCalc(JSON.parse(localStorage.getItem('lastProd')));
    else showPage(hash || 'homePage', false);
});

window.addEventListener('popstate', () => {
    const hash = location.hash.replace('#', '');
    if (hash === 'categoryView') openCat(localStorage.getItem('lastCat'));
    else if (hash === 'productCalculator') openCalc(JSON.parse(localStorage.getItem('lastProd')));
    else showPage(hash || 'homePage', false);
});
</script>
    <script>
window.addEventListener('load', function() {
    // التحقق إذا كان الزبون يريد الذهاب للمنتجات
    const params = new URLSearchParams(window.location.search);
    if (params.get('go') === 'categories') {
        const target = document.getElementById('categories');
        if (target) {
            // تأخير بسيط 500ms لضمان تحميل الصور والأقسام أولاً
            setTimeout(() => {
                window.scrollTo({
                    top: target.offsetTop - 100, // ترك مسافة بسيطة تحت الهيدر
                    behavior: 'smooth'
                });
            }, 500);
        }
    }
});
</script>
</body>
</html>
