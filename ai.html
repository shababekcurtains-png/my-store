<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shababek AI Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
--gold:#d9b382;
--brown:#3d2e24;
--bg:#f9f6f2;
--whatsapp:#25D366;
}
body{margin:0;background:var(--bg);font-family:'Cairo',sans-serif;text-align:center;color:var(--brown);}
header{background:#fff;padding:15px;font-weight:900;font-size:22px;box-shadow:0 5px 20px rgba(0,0,0,0.05);}
canvas{max-width:95%;margin-top:15px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.controls{margin-top:15px;display:flex;flex-wrap:wrap;justify-content:center;}
.btn{background:var(--gold);border:none;color:#fff;padding:12px 16px;margin:5px;border-radius:10px;font-weight:700;cursor:pointer;}
.btn:hover{opacity:.9}
.wa{background:var(--whatsapp);}
#aiResponse{background:#fff;padding:20px;margin:15px auto;max-width:700px;border-right:6px solid var(--gold);border-radius:20px;}
</style>
</head>

<body>

<header>Ø¯ÙƒØªÙˆØ± Ø¯ÙŠÙƒÙˆØ± AI â€” Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ù„Ù„Ø³ØªØ§Ø¦Ø±</header>

<div id="aiResponse">
Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ØºØ±ÙØªÙƒ ÙˆØ³Ø£Ù‚ØªØ±Ø­ Ù„Ùƒ Ø£ÙØ¶Ù„ Ø³ØªØ§Ø±Ø© Ù…ØªÙ†Ø§Ø³Ù‚Ø© âœ¨
</div>

<input type="file" accept="image/*" onchange="loadImage(this)">
<br>
<canvas id="canvas"></canvas>

<div class="controls">
<button class="btn" onclick="autoDetect()">ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
<button class="btn" onclick="refineEdges()">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¯Ù‚Ø©</button>
<button class="btn" onclick="applyCurtain()">ØªØ·Ø¨ÙŠÙ‚ Ø³ØªØ§Ø±Ø©</button>
<button class="btn" onclick="toggleCurtain()">ÙØªØ­ / Ø¥ØºÙ„Ø§Ù‚</button>
<button class="btn" onclick="changeColor()">ØªØºÙŠÙŠØ± ÙŠØ¯ÙˆÙŠ</button>
<button class="btn" onclick="smartColorMatch()">Ù„ÙˆÙ† Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
<button class="btn" onclick="measureWindow()">Ù‚ÙŠØ§Ø³</button>
<button class="btn" onclick="calculatePrice()">Ø­Ø³Ø§Ø¨ ØªÙƒÙ„ÙØ©</button>
<button class="btn" onclick="downloadImage()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
<button class="btn wa" onclick="sendToWhatsApp()">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<script>
let canvas=document.getElementById("canvas");
let ctx=canvas.getContext("2d");
let img=new Image();

let startX=0,startY=0,endX=0,endY=0;
let curtainOpen=false;
let curtainColor="rgba(217,179,130,0.85)";
let sheerColor="rgba(255,255,255,0.45)";
let lightLevel=0;

function loadImage(input){
if(!input.files[0]) return;
let reader=new FileReader();
reader.onload=e=>{
img.onload=()=>{
canvas.width=img.width;
canvas.height=img.height;
ctx.drawImage(img,0,0);
};
img.src=e.target.result;
};
reader.readAsDataURL(input.files[0]);
}

function autoDetect(){
ctx.drawImage(img,0,0);
let imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
let data=imageData.data;

let minX=canvas.width,minY=canvas.height,maxX=0,maxY=0;
let brightCount=0;

for(let y=0;y<canvas.height;y+=3){
for(let x=0;x<canvas.width;x+=3){
let i=(y*canvas.width+x)*4;
let brightness=(data[i]+data[i+1]+data[i+2])/3;
if(brightness>210){
brightCount++;
if(x<minX)minX=x;
if(y<minY)minY=y;
if(x>maxX)maxX=x;
if(y>maxY)maxY=y;
}
}
}

if(maxX-minX<60) return alert("Ù„Ù… ÙŠØªÙ… ÙƒØ´Ù Ø§Ù„Ø´Ø¨Ø§Ùƒ Ø¨Ø¯Ù‚Ø©");

startX=minX;startY=minY;endX=maxX;endY=maxY;
lightLevel=brightCount;

drawSelection();
}

function refineEdges(){
ctx.drawImage(img,0,0);
let imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
let data=imageData.data;
for(let i=0;i<data.length;i+=4){
let avg=(data[i]+data[i+1]+data[i+2])/3;
data[i]=data[i+1]=data[i+2]=avg>180?255:0;
}
ctx.putImageData(imageData,0,0);
}

function drawSelection(){
ctx.drawImage(img,0,0);
ctx.strokeStyle="#d9b382";
ctx.lineWidth=4;
ctx.strokeRect(startX,startY,endX-startX,endY-startY);
}

function applyCurtain(){
ctx.drawImage(img,0,0);
let w=endX-startX;
let h=endY-startY;
let visibleWidth=curtainOpen?w/6:w;

ctx.fillStyle=sheerColor;
ctx.fillRect(startX,startY,w,h);

ctx.fillStyle=curtainColor;
ctx.fillRect(startX,startY,visibleWidth,h);

for(let i=0;i<14;i++){
let foldX=startX+(i*(visibleWidth/14));
ctx.beginPath();
ctx.moveTo(foldX,startY);
ctx.lineTo(foldX,startY+h);
ctx.stroke();
}

confetti({particleCount:80,spread:60});
}

function toggleCurtain(){
curtainOpen=!curtainOpen;
applyCurtain();
}

function changeColor(){
if(curtainColor.includes("217")){
curtainColor="rgba(61,46,36,0.85)";
}else{
curtainColor="rgba(217,179,130,0.85)";
}
applyCurtain();
}

function smartColorMatch(){
ctx.drawImage(img,0,0);
let imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
let data=imageData.data;

let r=0,g=0,b=0,count=0;

for(let y=0;y<canvas.height;y+=5){
for(let x=0;x<canvas.width;x+=5){
if(x>startX && x<endX && y>startY && y<endY) continue;
let i=(y*canvas.width+x)*4;
r+=data[i];g+=data[i+1];b+=data[i+2];
count++;
}
}

let avgR=r/count;
let avgG=g/count;
let avgB=b/count;

let compR=(255-avgR+200)/2;
let compG=(255-avgG+180)/2;
let compB=(255-avgB+160)/2;

curtainColor=`rgba(${compR},${compG},${compB},0.85)`;
applyCurtain();
}

function measureWindow(){
let w=Math.abs(endX-startX)*0.26;
let h=Math.abs(endY-startY)*0.26;
alert("Ø§Ù„Ø¹Ø±Ø¶: "+w.toFixed(1)+" Ø³Ù…\nØ§Ù„Ø§Ø±ØªÙØ§Ø¹: "+h.toFixed(1)+" Ø³Ù…");
}

function calculatePrice(){
let w=Math.abs(endX-startX)*0.26;
let price=(w*18).toFixed(0);
alert("Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: "+price+" Ø±ÙŠØ§Ù„");
}

function downloadImage(){
let link=document.createElement('a');
link.download="shababek-design.png";
link.href=canvas.toDataURL();
link.click();
}

function sendToWhatsApp(){
let text="Ù…Ø±Ø­Ø¨Ø§ Ø´Ø¨Ø§Ø¨ÙŠÙƒ ğŸ‘‹ Ø£Ø±ÙŠØ¯ ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ø³ØªØ§Ø±Ø©.";
window.open("https://wa.me/9647883002797?text="+encodeURIComponent(text),"_blank");
}
</script>

</body>
</html>
