<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØªØ¯Ù‰ Ø´Ø¨Ø§Ø¨ÙŠÙƒ - Shababek Forum</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/3y1ZNCk0/1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root { 
            --gold: #d9b382; 
            --brown: #3d2e24; 
            --bg: #f9f6f2; 
            --white: #ffffff; 
            --whatsapp: #25D366;
            --red: #ff4d4d;
            --gray-light: #f0f0f0;
            --gray: #999;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        body { background: var(--white); color: var(--brown); overflow-x: hidden; line-height: 1.6; }
        body.admin-open { overflow: hidden !important; }

        .top-banner { 
            background: var(--brown); 
            color: white; 
            padding: 10px 5%; 
            text-align: center; 
            font-size: 13px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .wa-link { 
            color: var(--whatsapp); 
            text-decoration: none; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
        }
        
        header { 
            background: var(--white); 
            padding: 10px 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
        }
        
        .header-right { 
            flex: 1; 
            font-weight: 900; 
            line-height: 1.1; 
            cursor: pointer; 
        }
        
        .logo-center { 
            flex: 1; 
            display: flex; 
            justify-content: center; 
            cursor: pointer; 
        }
        
        .logo-img { 
            height: 90px; 
            transition: transform 0.3s;
        }
        
        .logo-img:hover {
            transform: scale(1.05);
        }
        
        .header-left { 
            flex: 1; 
            display: flex; 
            justify-content: flex-end; 
            align-items: center; 
            gap: 15px; 
        }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--brown);
            transition: 0.3s;
        }
        
        .notification-bell:hover {
            color: var(--gold);
        }
        
        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 50%;
            font-weight: 900;
        }
        
        .search-box { 
            position: relative; 
            width: 40px; 
            height: 40px; 
            transition: 0.4s; 
            overflow: hidden; 
            border: 1px solid #eee; 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
        }
        
        .search-box:hover, .search-box:focus-within { 
            width: 250px; 
            border-color: var(--gold); 
        }
        
        .search-box input { 
            border: none; 
            outline: none; 
            background: transparent; 
            padding: 10px; 
            width: 210px; 
            font-size: 0.9rem; 
        }
        
        .search-box i { 
            padding: 10px; 
            color: var(--brown); 
        }

        .nav-bar { 
            background: #fcfcfc; 
            border-bottom: 1px solid #eee; 
            padding: 12px 0; 
            overflow-x: auto; 
            white-space: nowrap; 
            scrollbar-width: none; 
        }
        
        .nav-menu { 
            display: inline-flex; 
            gap: 25px; 
            list-style: none; 
            padding: 0 20px; 
        }
        
        .nav-menu a { 
            text-decoration: none; 
            color: var(--brown); 
            font-weight: 700; 
            transition: 0.3s;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .nav-menu a:hover { 
            color: var(--gold);
            background: rgba(217, 179, 130, 0.1);
        }
        
        .nav-menu a.active { 
            color: var(--gold);
            background: rgba(217, 179, 130, 0.15);
        }

        .container { 
            padding: 30px 5%; 
            max-width: 1200px; 
            margin: auto; 
            min-height: 60vh; 
        }
        
        .page-title { 
            text-align: center; 
            font-weight: 900; 
            font-size: 2rem; 
            margin-bottom: 30px; 
            color: var(--brown);
            position: relative;
            padding-bottom: 15px;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--gold);
            border-radius: 3px;
        }
        
        .grid-layout { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 25px; 
        }
        
        .card-item { 
            position: relative; 
            height: 380px; 
            border-radius: 25px; 
            overflow: hidden; 
            cursor: pointer; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.06); 
            transition: all 0.4s ease; 
            border: 1px solid #f0f0f0; 
        }
        
        .card-item:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.15); 
        }
        
        .card-item img, .card-item video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: block; 
            transition: transform 0.6s;
        }
        
        .card-item:hover img,
        .card-item:hover video {
            transform: scale(1.1);
        }

        .card-overlay { 
            position: absolute; 
            bottom: 15px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 90%; 
            background: var(--gold); 
            color: white; 
            padding: 10px; 
            text-align: center; 
            border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            z-index: 10;
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        
        .card-overlay h3 { 
            font-weight: 900; 
            font-size: 1.1rem; 
            margin: 0; 
        }

        .topic-card { 
            background: #fff; 
            border-radius: 25px; 
            padding: 25px; 
            border: 1px solid #eee; 
            margin-bottom: 25px; 
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        
        .topic-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border-color: var(--gold);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-wrapper { 
            position: relative; 
            padding-bottom: 56.25%; 
            height: 0; 
            overflow: hidden; 
            border-radius: 15px; 
            margin: 15px 0;
            background: #000;
        }
        
        .video-wrapper iframe { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            border: none; 
        }
        
        .vid-shorts { 
            aspect-ratio: 9/16; 
            width: 100%; 
            max-width: 350px; 
            margin: 15px auto; 
        }
        
        .back-btn { 
            background: var(--brown); 
            color: white; 
            padding: 10px 25px; 
            border-radius: 30px; 
            cursor: pointer; 
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px; 
            font-weight: 700; 
            border: none; 
            transition: 0.3s;
        }
        
        .back-btn:hover {
            background: var(--gold);
            transform: translateX(5px);
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ */
        .topic-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .topic-actions button {
            background: none;
            border: 1px solid #eee;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            color: var(--brown);
            flex: 1;
            justify-content: center;
        }
        
        .topic-actions button:hover {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
            transform: translateY(-2px);
        }
        
        .topic-actions button i {
            font-size: 1.1rem;
        }
        
        .topic-actions button.liked {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
        .comments-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .comment {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .comment-author {
            font-weight: 700;
            color: var(--gold);
        }
        
        .comment-date {
            color: #999;
        }
        
        .comment-text {
            color: #444;
            line-height: 1.6;
        }
        
        .add-comment {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .add-comment input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-family: 'Cairo', sans-serif;
        }
        
        .add-comment button {
            background: var(--gold);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .add-comment button:hover {
            background: var(--brown);
            transform: scale(1.1);
        }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ³ÙˆÙ… */
        .topic-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        
        .tag {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .tag:hover {
            background: var(--gold);
            color: white;
            transform: translateY(-2px);
        }
        
        .tag.pinned {
            background: var(--gold);
            color: white;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
        .share-btn {
            background: none;
            border: 1px solid #eee;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--brown);
            margin-top: 10px;
        }
        
        .share-btn:hover {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        #forumAdminPanel { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            z-index: 9999; 
            overflow-y: auto; 
            padding: 30px 5%; 
        }
        
        .admin-box { 
            background: #f4f4f4; 
            padding: 25px; 
            border-radius: 20px; 
            margin-bottom: 25px; 
            text-align: right; 
            border: 1px solid #eee;
        }
        
        .admin-box h3 {
            color: var(--brown);
            margin-bottom: 15px;
            font-weight: 900;
        }
        
        input, select, textarea { 
            width: 100%; 
            padding: 12px 15px; 
            margin: 8px 0; 
            border-radius: 12px; 
            border: 1px solid #ddd; 
            font-family: 'Cairo', sans-serif;
            transition: 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(217, 179, 130, 0.2);
        }
        
        .btn-gold { 
            background: var(--gold); 
            color: white; 
            border: none; 
            padding: 15px; 
            border-radius: 12px; 
            font-weight: 900; 
            width: 100%; 
            cursor: pointer; 
            transition: 0.3s;
            font-size: 1rem;
        }
        
        .btn-gold:hover {
            background: var(--brown);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        #globalAudioBtn { 
            position: fixed; 
            bottom: 30px; 
            right: 30px; 
            width: 55px; 
            height: 55px; 
            background: var(--gold); 
            color: white; 
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer; 
            z-index: 9999; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: 0.3s;
        }
        
        #globalAudioBtn:hover {
            transform: scale(1.1);
            background: var(--brown);
        }

        .footer-cta { 
            background: var(--brown); 
            color: white; 
            padding: 60px 5%; 
            text-align: center; 
            border-radius: 45px 45px 0 0; 
            margin-top: 60px; 
        }
        
        .footer-cta h2 { 
            font-size: 1.8rem; 
            font-weight: 900; 
            margin-bottom: 25px; 
        }

        .footer-btns { 
            display: flex; 
            justify-content: center; 
            flex-wrap: wrap; 
            gap: 15px; 
        }

        .btn-footer-wa { 
            background: transparent; 
            border: 1px solid rgba(255, 255, 255, 0.4); 
            color: white; 
            padding: 12px 30px; 
            border-radius: 12px; 
            text-decoration: none; 
            font-weight: 700; 
            transition: 0.3s; 
        }
        
        .btn-footer-wa:hover {
            background: var(--whatsapp);
            border-color: var(--whatsapp);
        }

        .btn-footer-prod { 
            background: var(--gold); 
            color: white; 
            padding: 12px 30px; 
            border-radius: 12px; 
            text-decoration: none; 
            font-weight: 700; 
            transition: 0.3s; 
        }
        
        .btn-footer-prod:hover {
            background: white;
            color: var(--brown);
        }

        footer { 
            background: var(--brown); 
            color: rgba(255, 255, 255, 0.6); 
            padding: 30px 5%; 
            text-align: center; 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
        }

        .footer-logo { 
            font-size: 2.2rem; 
            font-weight: 900; 
            color: var(--gold); 
            margin-bottom: 10px; 
            cursor: pointer; 
            transition: 0.3s;
        }
        
        .footer-logo:hover {
            color: white;
        }

        .footer-copy { 
            font-size: 0.85rem; 
            opacity: 0.8; 
        }

        /* Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†Ø¨Ø«Ù‚ */
        .toast-message {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--brown);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10001;
            display: none;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                bottom: 0;
                opacity: 0;
            }
            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @media (max-width: 768px) { 
            .grid-layout { 
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            } 
            
            .card-item { 
                height: 320px; 
            }
            
            .footer-cta h2 { 
                font-size: 1.4rem; 
            }
            
            .footer-cta { 
                border-radius: 30px 30px 0 0; 
            }
            
            .topic-actions {
                flex-direction: column;
            }
            
            .topic-actions button {
                width: 100%;
            }
            
            .add-comment {
                flex-direction: column;
            }
            
            .add-comment button {
                width: 100%;
                border-radius: 30px;
            }
        }
    </style>
</head>
<body>

    <div class="top-banner">
        <span>Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ù„Ù„Ø³ØªØ§Ø¦Ø± - Ø¸Ù„ ÙˆØ°ÙˆÙ‚</span>
        <a href="https://wa.me/9647883002797" class="wa-link"><i class="fab fa-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>

    <header>
        <div class="header-right" onclick="location.href='index.html'">Ø´Ø¨Ø§Ø¨ÙŠÙƒ<br><span style="color:var(--gold); font-size:0.9rem;">Ù„Ù„Ø³ØªØ§Ø¦Ø±</span></div>
        <div class="logo-center" onclick="handleForumLogoClick()">
            <img src="https://i.ibb.co/3y1ZNCk0/1.png" class="logo-img">
        </div>
        <div class="header-left">
            <div class="notification-bell" onclick="showNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notification-count" id="notificationCount">0</span>
            </div>
            <div class="search-box">
                <i class="fas fa-search" onclick="handleForumSearch()"></i>
                <input type="text" id="forumSearchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹.." onkeyup="handleForumSearch()">
            </div>
        </div>
    </header>

    <div class="nav-bar">
        <ul class="nav-menu">
            <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="index.html?page=categories">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
            <li><a href="ai.html" class="active">Ù…Ù†ØªØ¯Ù‰ Ø´Ø¨Ø§Ø¨ÙŠÙƒ</a></li>
            <li><a href="index.html?page=paymentPage">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</a></li>
            <li><a href="index.html?page=aboutPage">Ù…Ù† Ù†Ø­Ù†</a></li>
            <li><a href="index.html?page=contactPage">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
    </div>

    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
    <div id="searchResults" style="display:none; position:absolute; top:110px; left:5%; width:90%; background:white; z-index:5000; box-shadow:0 10px 30px rgba(0,0,0,0.1); border-radius:20px; padding:15px; max-height:400px; overflow-y:auto;"></div>

    <div class="container" id="mainView">
        <div id="backBtnCont" style="display:none;">
            <button class="back-btn" onclick="renderSections()">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
            </button>
        </div>
        <h1 class="page-title" id="viewTitle">Ù†Ø§ÙØ°ØªÙƒ Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø°ÙˆÙ‚ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„</h1>
        <div class="grid-layout" id="forumGrid"></div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="commentsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center;">
        <div style="background:white; width:90%; max-width:600px; border-radius:30px; padding:30px; max-height:80vh; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="font-weight:900;">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
                <button onclick="closeCommentsModal()" style="background:var(--red); color:white; border:none; width:40px; height:40px; border-radius:50%; cursor:pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="commentsList"></div>
            <div class="add-comment">
                <input type="text" id="newComment" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ...">
                <button onclick="addComment()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div id="forumAdminPanel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="font-weight:900;">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØªØ¯Ù‰ Ø´Ø¨Ø§Ø¨ÙŠÙƒ</h2>
            <button onclick="closeAdminPanel()" style="background:var(--brown); color:white; border:none; padding:10px 20px; border-radius:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="admin-box">
            <h3>Ù¡. Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="newForumSecName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <input type="text" id="newForumSecImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù">
            <button onclick="saveForumSection()" class="btn-gold">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…</button>
            <div id="adminForumSecsList" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:10px;"></div>
        </div>
        <div class="admin-box">
            <h3>Ù¢. Ù†Ø´Ø± Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
            <select id="selectTopicSec"></select>
            <input type="text" id="postTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <textarea id="postDesc" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..." rows="4"></textarea>
            <input type="text" id="postTags" placeholder="ÙˆØ³ÙˆÙ… (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø©)">
            <select id="postType" onchange="toggleMediaInput()">
                <option value="vid">ÙŠÙˆØªÙŠÙˆØ¨ (Ø°ÙƒÙŠ)</option>
                <option value="img">ØµÙˆØ±Ø©</option>
                <option value="text">Ù†Øµ ÙÙ‚Ø·</option>
            </select>
            <input type="text" id="postMediaUrl" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·">
            <label style="display:flex; align-items:center; gap:10px; margin:10px 0;">
                <input type="checkbox" id="postPinned"> <span>ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</span>
            </label>
            <button onclick="publishTopic()" class="btn-gold" id="btnPublish">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
        </div>
        <div class="admin-box">
            <h3>Ù£. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</h3>
            <div id="adminTopicsList"></div>
        </div>
    </div>

    <div class="footer-cta">
        <h2>Ø¬Ø§Ù‡Ø² Ù„ØªØ¬Ø¯ÙŠØ¯ Ø³ØªØ§Ø¦Ø± Ù…Ù†Ø²Ù„ÙƒØŸ</h2>
        <div class="footer-btns">
            <a href="https://wa.me/9647883002797" class="btn-footer-wa">ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
            <a href="index.html" class="btn-footer-prod">ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
        </div>
    </div>

    <footer>
        <div class="footer-logo" onclick="location.href='index.html'">Ø´Ø¨Ø§Ø¨ÙŠÙƒ</div>
        <p class="footer-copy">Â© 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ù„Ù„Ø³ØªØ§Ø¦Ø± - Ø¸Ù„ ÙˆØ°ÙˆÙ‚</p>
    </footer>

    <div id="globalAudioBtn" onclick="toggleGlobalMute()">
        <i id="audioIcon" class="fas fa-volume-mute"></i>
    </div>

    <div class="toast-message" id="toastMessage"></div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = { 
            apiKey: "AIzaSyD1TENeV6RkWmrYIjV6seGx84VavsM_tvE", 
            authDomain: "shababekcurtain.firebaseapp.com", 
            databaseURL: "https://shababekcurtain-default-rtdb.asia-southeast1.firebasedatabase.app/", 
            projectId: "shababekcurtain" 
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let forumClicks = 0;
        let sectionsData = {};
        let topicsData = [];
        let isGlobalMuted = true;
        let currentTopicId = null;
        let notifications = [];

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function showToast(message) {
            const toast = document.getElementById('toastMessage');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function handleForumLogoClick() {
            forumClicks++;
            if(forumClicks >= 5) {
                const pass = prompt("Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
                if(pass === "8496") {
                    document.getElementById('forumAdminPanel').style.display = 'block';
                    document.body.classList.add('admin-open');
                    showToast('ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©');
                }
                forumClicks = 0;
            }
        }

        function closeAdminPanel() {
            document.getElementById('forumAdminPanel').style.display = 'none';
            document.body.classList.remove('admin-open');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¯Ù‰
        function loadForumData() {
            db.ref('forumSections').on('value', snap => {
                sectionsData = snap.val() || {};
                renderSections();
                updateAdminLists();
            });
            
            db.ref('forumTopics').on('value', snap => {
                topicsData = [];
                snap.forEach(child => { 
                    topicsData.push({ id: child.key, ...child.val() }); 
                });
                updateAdminTopics();
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
                const today = new Date().toDateString();
                const newTopics = topicsData.filter(t => t.date === today).length;
                document.getElementById('notificationCount').textContent = newTopics || '0';
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function renderSections() {
            const grid = document.getElementById('forumGrid');
            const backBtn = document.getElementById('backBtnCont');
            const title = document.getElementById('viewTitle');
            
            grid.innerHTML = "";
            backBtn.style.display = "none";
            title.innerText = "Ù†Ø§ÙØ°ØªÙƒ Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø°ÙˆÙ‚ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„";
            
            if (Object.keys(sectionsData).length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            Object.entries(sectionsData).forEach(([id, sec]) => {
                const isVideo = sec.img && sec.img.toLowerCase().endsWith('.mp4');
                grid.innerHTML += `
                    <div class="card-item" onclick="renderTopics('${sec.name}')">
                        ${isVideo ? 
                            `<video src="${sec.img}" autoplay loop muted playsinline></video>` : 
                            `<img src="${sec.img || 'https://i.ibb.co/0R1MK2d7/Gemini-Generated-Image-tnocdatnocdatnoc.png'}">`}
                        <div class="card-overlay"><h3>${sec.name}</h3></div>
                    </div>`;
            });
        }

        // Ø¹Ø±Ø¶ Ù…ÙˆØ§Ø¶ÙŠØ¹ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
        function renderTopics(sectionName) {
            const grid = document.getElementById('forumGrid');
            const backBtn = document.getElementById('backBtnCont');
            const title = document.getElementById('viewTitle');
            
            grid.innerHTML = `<div class="loading-spinner"></div>`;
            backBtn.style.display = "block";
            title.innerText = "Ù‚Ø³Ù…: " + sectionName;

            setTimeout(() => {
                const filtered = topicsData.filter(t => t.section === sectionName);
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹: Ø§Ù„Ù…Ø«Ø¨ØªØ© Ø£ÙˆÙ„Ø§Ù‹
                const pinned = filtered.filter(t => t.pinned);
                const normal = filtered.filter(t => !t.pinned);
                const sorted = [...pinned, ...normal].reverse();
                
                if (sorted.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¶ÙŠØ¹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</div>';
                    return;
                }

                grid.innerHTML = sorted.map(t => {
                    const vidId = extractYoutubeId(t.media || "");
                    const isShorts = t.media && t.media.includes('shorts');
                    let mediaHtml = "";

                    if (t.type === 'img' && t.media) {
                        mediaHtml = `<div class="media-container"><img src="${t.media}" style="width:100%; border-radius:15px;"></div>`;
                    } else if (vidId) {
                        const containerClass = isShorts ? "vid-shorts" : "video-wrapper";
                        mediaHtml = `
                            <div class="${containerClass}">
                                <iframe class="lazy-video" width="100%" height="100%"
                                    data-src="https://www.youtube.com/embed/${vidId}?enablejsapi=1&mute=1&playlist=${vidId}&loop=1" 
                                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
                                </iframe>
                            </div>`;
                    }

                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ³ÙˆÙ…
                    const tags = t.tags ? t.tags.split(',').map(tag => 
                        `<span class="tag" onclick="searchByTag('${tag.trim()}')">#${tag.trim()}</span>`
                    ).join('') : '';

                    return `
                        <div class="topic-card" id="topic-${t.id}">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                                ${t.pinned ? '<span class="tag pinned"><i class="fas fa-thumbtack"></i> Ù…Ø«Ø¨Øª</span>' : ''}
                            </div>
                            <h3 style="font-weight:900; margin-bottom:10px; font-size:1.3rem;">${t.title}</h3>
                            <div class="topic-tags">${tags}</div>
                            <p style="white-space:pre-wrap; font-size:0.95rem; color:#444; line-height:1.8;">${t.desc || ''}</p>
                            ${mediaHtml}
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px; font-size:0.8rem; color:#999;">
                                <span>ğŸ“… ${t.date || ''}</span>
                                <button class="share-btn" onclick="shareTopic('${t.id}')">
                                    <i class="fas fa-share-alt"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                                </button>
                            </div>
                            <div class="topic-actions">
                                <button onclick="likeTopic('${t.id}')" id="like-btn-${t.id}">
                                    <i class="far fa-heart"></i> <span id="likes-${t.id}">${t.likes || 0}</span>
                                </button>
                                <button onclick="showComments('${t.id}')">
                                    <i class="far fa-comment"></i> <span>${t.comments ? Object.keys(t.comments).length : 0}</span>
                                </button>
                            </div>
                        </div>`;
                }).join('');
                
                initAutoPlay();
            }, 500);
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
        function likeTopic(topicId) {
            const topic = topicsData.find(t => t.id === topicId);
            const likesSpan = document.getElementById(`likes-${topicId}`);
            const likeBtn = document.getElementById(`like-btn-${topicId}`);
            
            if (likeBtn.classList.contains('liked')) {
                // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
                let count = parseInt(likesSpan.textContent) || 0;
                likesSpan.textContent = Math.max(0, count - 1);
                likeBtn.classList.remove('liked');
                db.ref('forumTopics').child(topicId).update({ 
                    likes: Math.max(0, count - 1)
                });
                showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨');
            } else {
                // Ø¥Ø¹Ø¬Ø§Ø¨
                let count = parseInt(likesSpan.textContent) || 0;
                likesSpan.textContent = count + 1;
                likeBtn.classList.add('liked');
                db.ref('forumTopics').child(topicId).update({ 
                    likes: count + 1
                });
                showToast('ğŸ‘ ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨');
                
                // Ø§Ø­ØªÙØ§Ù„ Ø¨Ø³ÙŠØ·
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 30,
                        spread: 30,
                        origin: { y: 0.8 }
                    });
                }
            }
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
        function showComments(topicId) {
            currentTopicId = topicId;
            const topic = topicsData.find(t => t.id === topicId);
            const comments = topic.comments || {};
            
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = Object.entries(comments).map(([id, comment]) => `
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">ğŸ‘¤ ${comment.author || 'Ù…Ø³ØªØ®Ø¯Ù…'}</span>
                        <span class="comment-date">${comment.date || ''}</span>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                </div>
            `).join('') || '<p style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</p>';
            
            document.getElementById('commentsModal').style.display = 'flex';
        }

        function closeCommentsModal() {
            document.getElementById('commentsModal').style.display = 'none';
            currentTopicId = null;
        }

        function addComment() {
            if (!currentTopicId) return;
            
            const commentText = document.getElementById('newComment').value.trim();
            if (!commentText) return;
            
            const commentId = Date.now().toString();
            const comment = {
                text: commentText,
                author: 'Ù…Ø³ØªØ®Ø¯Ù…',
                date: new Date().toLocaleDateString('ar-EG')
            };
            
            db.ref('forumTopics').child(currentTopicId).child('comments').child(commentId).set(comment)
                .then(() => {
                    document.getElementById('newComment').value = '';
                    showComments(currentTopicId);
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚');
                });
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯Ù‰
        function handleForumSearch() {
            const query = document.getElementById('forumSearchInput').value.trim().toLowerCase();
            const resultsBox = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsBox.style.display = 'none';
                return;
            }
            
            const results = topicsData.filter(t => 
                t.title.toLowerCase().includes(query) ||
                t.desc?.toLowerCase().includes(query) ||
                t.tags?.toLowerCase().includes(query)
            );
            
            if (results.length === 0) {
                resultsBox.innerHTML = '<div style="padding:15px; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                resultsBox.style.display = 'block';
                return;
            }
            
            resultsBox.innerHTML = results.map(t => `
                <div style="padding:12px; border-bottom:1px solid #eee; cursor:pointer;" 
                     onclick="renderTopics('${t.section}'); document.getElementById('forumSearchInput').value=''; resultsBox.style.display='none';">
                    <div style="font-weight:bold; color:var(--brown);">${t.title}</div>
                    <div style="font-size:0.8rem; color:var(--gold);">Ø§Ù„Ù‚Ø³Ù…: ${t.section}</div>
                </div>
            `).join('');
            
            resultsBox.style.display = 'block';
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙˆØ³Ù…
        function searchByTag(tag) {
            document.getElementById('forumSearchInput').value = tag;
            handleForumSearch();
        }

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
        function shareTopic(topicId) {
            const url = `${window.location.origin}${window.location.pathname}?topic=${topicId}`;
            navigator.clipboard.writeText(url).then(() => {
                showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotifications() {
            const today = new Date().toDateString();
            const newTopics = topicsData.filter(t => t.date === today);
            
            if (newTopics.length === 0) {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©');
                return;
            }
            
            let msg = 'ğŸ“¢ Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…:\n';
            newTopics.forEach(t => {
                msg += `\nâ€¢ ${t.title}`;
            });
            alert(msg);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function initAutoPlay() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const iframe = entry.target;
                    if (entry.isIntersecting) {
                        if (!iframe.src) iframe.src = iframe.getAttribute('data-src') + "&autoplay=1";
                        iframe.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                        const audioCmd = isGlobalMuted ? 'mute' : 'unMute';
                        setTimeout(() => { 
                            iframe.contentWindow?.postMessage(`{"event":"command","func":"${audioCmd}","args":""}`, '*'); 
                        }, 600);
                    } else {
                        iframe.contentWindow?.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                    }
                });
            }, { threshold: 0.5 });
            
            document.querySelectorAll('.lazy-video').forEach(vid => observer.observe(vid));
        }

        // ÙƒØªÙ… Ø§Ù„ØµÙˆØª
        function toggleGlobalMute() {
            isGlobalMuted = !isGlobalMuted;
            const icon = document.getElementById('audioIcon');
            icon.className = isGlobalMuted ? "fas fa-volume-mute" : "fas fa-volume-up";
            
            if (!isGlobalMuted && typeof confetti === 'function') {
                confetti({ particleCount: 40, spread: 40, origin: { y: 0.9, x: 0.9 } });
            }
            
            document.querySelectorAll('.lazy-video').forEach(iframe => {
                const cmd = isGlobalMuted ? 'mute' : 'unMute';
                iframe.contentWindow?.postMessage(`{"event":"command","func":"${cmd}","args":""}`, '*');
            });
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        function saveForumSection() {
            const name = document.getElementById('newForumSecName').value.trim();
            const img = document.getElementById('newForumSecImg').value.trim();
            
            if(!name) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…');
                return;
            }
            
            db.ref('forumSections').push({ name, img }).then(() => {
                document.getElementById('newForumSecName').value = "";
                document.getElementById('newForumSecImg').value = "";
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­');
            });
        }

        function publishTopic() {
            const title = document.getElementById('postTitle').value.trim();
            const desc = document.getElementById('postDesc').value.trim();
            const section = document.getElementById('selectTopicSec').value;
            const type = document.getElementById('postType').value;
            const media = document.getElementById('postMediaUrl').value.trim();
            const tags = document.getElementById('postTags').value.trim();
            const pinned = document.getElementById('postPinned').checked;
            
            if(!title || !section) {
                alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
                return;
            }
            
            db.ref('forumTopics').push({ 
                title, 
                desc, 
                section, 
                type, 
                media: type === 'text' ? '' : media, 
                tags,
                pinned,
                likes: 0,
                timestamp: Date.now(), 
                date: new Date().toLocaleDateString('ar-EG') 
            }).then(() => { 
                document.getElementById('postTitle').value = "";
                document.getElementById('postDesc').value = "";
                document.getElementById('postMediaUrl').value = "";
                document.getElementById('postTags').value = "";
                document.getElementById('postPinned').checked = false;
                showToast('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
            });
        }

        function updateAdminLists() {
            const select = document.getElementById('selectTopicSec');
            const adminList = document.getElementById('adminForumSecsList');
            
            if(!select || !adminList) return;
            
            let selectHtml = '<option disabled selected value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';
            let adminHtml = "";
            
            Object.entries(sectionsData).forEach(([k, v]) => {
                selectHtml += `<option value="${v.name}">${v.name}</option>`;
                adminHtml += `<div style="background:#ddd; padding:5px 15px; border-radius:20px; font-size:0.8rem;">
                                ${v.name} 
                                <i class="fas fa-times" onclick="deleteItem('forumSections','${k}')" style="color:red; cursor:pointer; margin-right:5px;"></i>
                              </div>`;
            });
            
            select.innerHTML = selectHtml;
            adminList.innerHTML = adminHtml;
        }

        function updateAdminTopics() {
            const list = document.getElementById('adminTopicsList');
            if(!list) return;
            
            list.innerHTML = topicsData.reverse().map(t => `
                <div style="padding:12px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span style="font-weight:700;">${t.title}</span>
                        ${t.pinned ? '<span style="background:var(--gold); color:white; padding:2px 8px; border-radius:12px; font-size:0.7rem; margin-right:8px;">Ù…Ø«Ø¨Øª</span>' : ''}
                    </div>
                    <div>
                        <button onclick="deleteItem('forumTopics','${t.id}')" style="color:red; border:none; background:none; cursor:pointer; margin-left:10px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteItem(path, key) { 
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
                db.ref(path).child(key).remove().then(() => {
                    showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
                });
            }
        }

        function extractYoutubeId(url) {
            if (!url) return null;
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?)\??v?=?|shorts\/)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[7]?.length === 11) ? match[7] : null;
        }

        function toggleMediaInput() {
            const type = document.getElementById('postType').value;
            const mediaInput = document.getElementById('postMediaUrl');
            mediaInput.style.display = (type === 'text') ? 'none' : 'block';
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', (e) => {
            const searchBox = document.querySelector('.search-box');
            const searchRes = document.getElementById('searchResults');
            if (searchBox && searchRes && !searchBox.contains(e.target) && !searchRes.contains(e.target)) {
                searchRes.style.display = 'none';
            }
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        window.addEventListener('load', () => {
            loadForumData();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ÙˆØ¶ÙˆØ¹ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
            const urlParams = new URLSearchParams(window.location.search);
            const topicId = urlParams.get('topic');
            if (topicId) {
                setTimeout(() => {
                    const topic = topicsData.find(t => t.id === topicId);
                    if (topic) {
                        renderTopics(topic.section);
                        setTimeout(() => {
                            document.getElementById(`topic-${topicId}`)?.scrollIntoView({ behavior: 'smooth' });
                        }, 1000);
                    }
                }, 1500);
            }
        });
    </script>
</body>
</html>
