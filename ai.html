<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯ÙƒØªÙˆØ± Ø¯ÙŠÙƒÙˆØ± - Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ù„Ù„Ø³ØªØ§Ø¦Ø±</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
:root{--gold:#d9b382;--brown:#3d2e24;--bg:#f9f6f2;--whatsapp:#25D366;}
body{margin:0;font-family:'Cairo',sans-serif;background:var(--bg);color:var(--brown);text-align:center;}
header{background:#fff;padding:15px;font-weight:900;font-size:22px;box-shadow:0 5px 20px rgba(0,0,0,0.05);}
canvas{max-width:95%;margin-top:15px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.controls{margin-top:15px;display:flex;flex-wrap:wrap;justify-content:center;}
.btn{background:var(--gold);border:none;color:white;padding:12px 16px;margin:5px;border-radius:10px;font-weight:700;cursor:pointer;}
.btn:hover{opacity:.9;}
.wa{background:var(--whatsapp);}
#aiResponse{background:white;padding:20px;margin:15px auto;max-width:700px;border-right:6px solid var(--gold);border-radius:20px;line-height:1.8;}
.avatar-container{width:120px;height:120px;margin:10px auto;border-radius:50%;border:4px solid var(--gold);overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
#drAvatar{width:100%;height:100%;object-fit:contain;transition:0.3s;}
.suggestion-grid{display:flex;justify-content:center;gap:15px;margin-top:20px;}
.suggestion-card{border:1px solid #eee;border-radius:12px;overflow:hidden;width:150px;cursor:pointer;transition:0.3s;}
.suggestion-card img{width:100%;height:150px;object-fit:cover;}
.suggestion-card:hover{transform:scale(1.05);}
</style>
</head>
<body>

<header>Ø¯ÙƒØªÙˆØ± Ø¯ÙŠÙƒÙˆØ± - Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ù„Ù„Ø³ØªØ§Ø¦Ø±</header>

<div class="avatar-container">
<img id="drAvatar" src="https://i.ibb.co/q3z1RscN/Neutral-removebg-preview.png">
</div>

<div id="aiResponse">Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ØºØ±ÙØªÙƒ ÙˆØ³Ø£Ù‚ØªØ±Ø­ Ù„Ùƒ Ø³ØªØ§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© ÙÙˆÙ‚ Ø§Ù„Ø´Ø¨Ø§Ùƒ âœ¨</div>

<input type="file" accept="image/*" id="inputImage"><br>
<canvas id="canvas"></canvas>

<div class="controls">
<button class="btn" onclick="autoDetect()">ÙƒØ´Ù Ø§Ù„Ø´Ø¨Ø§Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
<button class="btn" onclick="smartColorMatch()">Ù„ÙˆÙ† Ø³ØªØ§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
<button class="btn" onclick="toggleCurtain()">ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³ØªØ§Ø±Ø©</button>
<button class="btn" onclick="downloadImage()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
<button class="btn wa" onclick="sendToWhatsApp()"><i class="fab fa-whatsapp"></i></button>
</div>

<div class="suggestion-grid" id="suggestions"></div>

<script>
let canvas=document.getElementById("canvas");
let ctx=canvas.getContext("2d");
let img=new Image();
let startX=0,startY=0,endX=0,endY=0;
let curtainOpen=false;
let curtainImg=new Image();
let curtainColor="rgba(217,179,130,0.85)";
let drAvatar=document.getElementById("drAvatar");
let inputImage=document.getElementById("inputImage");
let suggestionsDiv=document.getElementById("suggestions");

// Ù…Ø¬Ù…ÙˆØ¹Ø© ØµÙˆØ± Ø³ØªØ§Ø¦Ø± Ø¬Ø§Ù‡Ø²Ø© (ØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø±)
let curtainOptions=[
{src:"https://images.unsplash.com/photo-1513519245088-0e12902e5a38?w=400", name:"Ø³ØªØ§Ø±Ø© Ø¨ÙŠØ¬"},
{src:"https://images.unsplash.com/photo-1541123437800-1bb1317badc2?w=400", name:"Ø³ØªØ§Ø±Ø© Ø¨Ù†ÙŠØ©"},
{src:"https://images.unsplash.com/photo-1617325252256-752118253fbc?w=400", name:"Ø³ØªØ§Ø±Ø© Ø±Ù…Ø§Ø¯ÙŠØ©"}
];

// Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
inputImage.addEventListener("change",(e)=>{
if(!e.target.files[0]) return;
let reader=new FileReader();
reader.onload=function(ev){
img.onload=function(){
canvas.width=img.width;
canvas.height=img.height;
ctx.drawImage(img,0,0);
drAvatar.src="https://i.ibb.co/q3z1RscN/Neutral-removebg-preview.png";
displaySuggestions();
};
img.src=ev.target.result;
};
reader.readAsDataURL(e.target.files[0]);
});

// Ø¹Ø±Ø¶ Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ø³ØªØ§Ø¦Ø±
function displaySuggestions(){
suggestionsDiv.innerHTML="";
curtainOptions.forEach(opt=>{
let card=document.createElement("div");
card.className="suggestion-card";
card.innerHTML=`<img src="${opt.src}"><p>${opt.name}</p>`;
card.onclick=()=>{
curtainImg.src=opt.src;
applyCurtain();
document.getElementById("aiResponse").innerHTML=`ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${opt.name}`;
};
suggestionsDiv.appendChild(card);
});
}

// ÙƒØ´Ù Ø§Ù„Ø´Ø¨Ø§Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
function autoDetect(){
if(!img.src) return alert("Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
drAvatar.src="https://i.ibb.co/ZzMvg7Mz/Disgust-removebg-preview.png"; // ØªÙÙƒÙŠØ±
ctx.drawImage(img,0,0);
let data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
let minX=canvas.width,minY=canvas.height,maxX=0,maxY=0;
let brightCount=0;
for(let y=0;y<canvas.height;y+=3){
for(let x=0;x<canvas.width;x+=3){
let i=(y*canvas.width+x)*4;
let brightness=(data[i]+data[i+1]+data[i+2])/3;
if(brightness>210){
brightCount++;
if(x<minX)minX=x;if(y<minY)minY=y;
if(x>maxX)maxX=x;if(y>maxY)maxY=y;
}}}
if(maxX-minX<60){ drAvatar.src="https://i.ibb.co/q3z1RscN/Neutral-removebg-preview.png"; return alert("Ù„Ù… Ø£Ø³ØªØ·Ø¹ ÙƒØ´Ù Ø§Ù„Ø´Ø¨Ø§Ùƒ Ø¨Ø¯Ù‚Ø© ğŸ˜…"); }
startX=minX;startY=minY;endX=maxX;endY=maxY;
drAvatar.src="https://i.ibb.co/q3z1RscN/Neutral-removebg-preview.png";
document.getElementById("aiResponse").innerHTML="ØªÙ… ÙƒØ´Ù Ø§Ù„Ø´Ø¨Ø§Ùƒ. Ø§Ø®ØªØ± Ø§Ù„Ø³ØªØ§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ğŸ‘Œ";
applyCurtain();
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³ØªØ§Ø±Ø© ÙÙˆÙ‚ Ø§Ù„Ø´Ø¨Ø§Ùƒ
function applyCurtain(){
if(!curtainImg.src) return;
ctx.drawImage(img,0,0);
let w=endX-startX, h=endY-startY;
ctx.drawImage(curtainImg,startX,startY,w,h);
if(!curtainOpen){
ctx.globalAlpha=0.3; ctx.fillStyle="white"; ctx.fillRect(startX,startY,w,h); ctx.globalAlpha=1;
}}
function toggleCurtain(){curtainOpen=!curtainOpen; applyCurtain();}

// Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙŠÙˆØ¬Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø³ØªØ§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨Ø©)
function smartColorMatch(){
let tempCanvas=document.createElement("canvas");
let tCtx=tempCanvas.getContext("2d");
tempCanvas.width=canvas.width; tempCanvas.height=canvas.height;
tCtx.drawImage(img,0,0);
let data=tCtx.getImageData(0,0,canvas.width,canvas.height).data;
let r=0,g=0,b=0,count=0;
for(let y=0;y<canvas.height;y+=5){
for(let x=0;x<canvas.width;x+=5){
if(x>startX && x<endX && y>startY && y<endY) continue;
let i=(y*canvas.width+x)*4;
r+=data[i]; g+=data[i+1]; b+=data[i+2]; count++;
}}
let avgR=Math.floor(r/count), avgG=Math.floor(g/count), avgB=Math.floor(b/count);
let minDiff=99999, chosen=null;
curtainOptions.forEach(opt=>{
let imgCol=new Image(); imgCol.src=opt.src; // Ø³Ù‡Ù„ Ø§Ù„ØªØºÙŠÙŠØ± Ù„Ø§Ø­Ù‚Ø§Ù‹
let diff=Math.abs(avgR-200)+Math.abs(avgG-150)+Math.abs(avgB-100); // ØªÙ‚Ø±ÙŠØ¨
if(diff<minDiff){minDiff=diff; chosen=opt;}
});
if(chosen){curtainImg.src=chosen.src; applyCurtain(); document.getElementById("aiResponse").innerHTML=`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† Ø³ØªØ§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨: ${chosen.name}`;}
}

// Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©
function downloadImage(){
let link=document.createElement("a");
link.download="shababek-room.png";
link.href=canvas.toDataURL();
link.click();
}

// ÙˆØ§ØªØ³Ø§Ø¨
function sendToWhatsApp(){
let text="Ù…Ø±Ø­Ø¨Ø§ Ø´Ø¨Ø§Ø¨ÙŠÙƒ ğŸ‘‹ Ø£Ø±ÙŠØ¯ ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ø³ØªØ§Ø±Ø©.";
window.open("https://wa.me/9647883002797?text="+encodeURIComponent(text),"_blank");
}
</script>
</body>
</html>
