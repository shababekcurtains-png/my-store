// استبدل وظيفة الـ FileReader في ملف ai.html بهذا المنطق الذكي
reader.onload = async (event) => {
    const base64 = event.target.result;

    try {
        const response = await fetch(WORKER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image: base64 })
        });

        const data = await response.json();
        aiText.innerText = data.reply;

        // 1. ميزة النطق الصوتي للتحليل
        const voice = new SpeechSynthesisUtterance(data.reply);
        voice.lang = 'ar-SA'; 
        voice.rate = 0.9; // سرعة هادئة لتناسب اللهجة
        window.speechSynthesis.speak(voice);

        // 2. نظام اختيار الصور الذكي من منتجات شبابيك
        // هنا نقوم بفحص الكلمات المفتاحية في رد الـ AI لتغيير الصور
        const img1 = document.getElementById('resImg1');
        const img2 = document.getElementById('resImg2');

        if (data.reply.includes("فاتح") || data.reply.includes("مودرن")) {
            // صور منتجات المودرن من موقعك
            img1.src = "https://images.unsplash.com/photo-1513519245088-0e12902e5a38?w=400"; 
            img2.src = "https://images.unsplash.com/photo-1541123437800-1bb1317badc2?w=400";
        } else if (data.reply.includes("غامق") || data.reply.includes("كلاسيك")) {
            // صور منتجات الكلاسيك من موقعك
            img1.src = "https://images.unsplash.com/photo-1617325252256-752118253fbc?w=400";
            img2.src = "https://images.unsplash.com/photo-1584622781564-1d9876a13d00?w=400";
        }

        suggestions.style.display = "block";

    } catch (err) {
        aiText.innerText = "عذراً عيني، صار خلل بسيط بالتحليل. جرب مرة ثانية.";
    }
};
